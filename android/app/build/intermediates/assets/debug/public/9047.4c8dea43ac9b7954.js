"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9047],{9047:(te,Z,c)=>{c.r(Z),c.d(Z,{GestionReservasPageModule:()=>X});var f=c(6814),_=c(6223),l=c(878),p=c(9634),m=c(5861),C=c(7394);class A extends C.w0{constructor(i,o){super()}schedule(i,o=0){return this}}const h={setInterval(r,i,...o){const{delegate:t}=h;return null!=t&&t.setInterval?t.setInterval(r,i,...o):setInterval(r,i,...o)},clearInterval(r){const{delegate:i}=h;return((null==i?void 0:i.clearInterval)||clearInterval)(r)},delegate:void 0};var R=c(9039);const b={now:()=>(b.delegate||Date).now(),delegate:void 0};class v{constructor(i,o=v.now){this.schedulerActionCtor=i,this.now=o}schedule(i,o=0,t){return new this.schedulerActionCtor(this,i).schedule(t,o)}}v.now=b.now;const P=new class T extends v{constructor(i,o=v.now){super(i,o),this.actions=[],this._active=!1}flush(i){const{actions:o}=this;if(this._active)return void o.push(i);let t;this._active=!0;do{if(t=i.execute(i.state,i.delay))break}while(i=o.shift());if(this._active=!1,t){for(;i=o.shift();)i.unsubscribe();throw t}}}(class y extends A{constructor(i,o){super(i,o),this.scheduler=i,this.work=o,this.pending=!1}schedule(i,o=0){var t;if(this.closed)return this;this.state=i;const n=this.id,s=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(s,n,o)),this.pending=!0,this.delay=o,this.id=null!==(t=this.id)&&void 0!==t?t:this.requestAsyncId(s,this.id,o),this}requestAsyncId(i,o,t=0){return h.setInterval(i.flush.bind(i,this),t)}recycleAsyncId(i,o,t=0){if(null!=t&&this.delay===t&&!1===this.pending)return o;null!=o&&h.clearInterval(o)}execute(i,o){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const t=this._execute(i,o);if(t)return t;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(i,o){let n,t=!1;try{this.work(i)}catch(s){t=!0,n=s||new Error("Scheduled action threw falsy error")}if(t)return this.unsubscribe(),n}unsubscribe(){if(!this.closed){const{id:i,scheduler:o}=this,{actions:t}=o;this.work=this.state=this.scheduler=null,this.pending=!1,(0,R.P)(t,this),null!=i&&(this.id=this.recycleAsyncId(o,i,null)),this.delay=null,super.unsubscribe()}}}),w=P;var F=c(5592),E=c(671);var I=c(4180),e=c(9212),O=c(2333),k=c(2759),N=c(2042),J=c(9306),D=c(405),z=c(2471);const q=["idEmpresaInput"];function H(r,i){if(1&r){const o=e.EpF();e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),e._UZ(3,"ion-back-button",3),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"Gesti\xf3n Reservas"),e.qZA(),e.TgZ(6,"ion-buttons",4)(7,"ion-button",5),e.NdJ("click",function(){e.CHM(o);const n=e.oxw();return e.KtG(n.toggleDarkMode())}),e._UZ(8,"ion-icon",6),e.qZA(),e.TgZ(9,"ion-button",5),e.NdJ("click",function(){e.CHM(o);const n=e.oxw();return e.KtG(n.cerrarSesion())}),e._UZ(10,"ion-icon",7),e.qZA()()()()}if(2&r){const o=e.oxw();e.Tol(o.isDarkMode?"dark-theme":""),e.xp6(8),e.Q6J("name",o.isDarkMode?"sunny-outline":"moon-outline")}}function Y(r,i){if(1&r){const o=e.EpF();e.TgZ(0,"ion-button",29),e.NdJ("click",function(){e.CHM(o);const n=e.oxw(2);return e.KtG(n.borrarFiltro())}),e._UZ(1,"ion-icon",30),e.qZA()}}function j(r,i){if(1&r){const o=e.EpF();e.TgZ(0,"ion-button",29),e.NdJ("click",function(){e.CHM(o);const n=e.oxw(2);return e.KtG(n.borrarFiltro())}),e._UZ(1,"ion-icon",30),e.qZA()}}function Q(r,i){if(1&r){const o=e.EpF();e.TgZ(0,"ion-icon",38),e.NdJ("click",function(n){e.CHM(o);const s=e.oxw().$implicit,a=e.oxw(2);return e.KtG(a.mostrarDetallesCliente(n,s))}),e._uU(1),e.qZA()}if(2&r){const o=e.oxw().$implicit;e.xp6(),e.hij(" ",o.id_cliente," ")}}const K=r=>({"background-color":r});function $(r,i){if(1&r){const o=e.EpF();e.TgZ(0,"ion-card",31)(1,"ion-card-content",32)(2,"ion-row")(3,"ion-col",33)(4,"label"),e._uU(5,"Fecha y Hora:"),e.qZA(),e.TgZ(6,"p",34),e._uU(7),e.qZA(),e.TgZ(8,"label"),e._uU(9,"Num. de Pax:"),e.qZA(),e.TgZ(10,"p",34),e._uU(11),e.qZA(),e.TgZ(12,"label"),e._uU(13,"Notas:"),e.qZA(),e.TgZ(14,"p",34),e._uU(15),e.qZA()(),e.TgZ(16,"ion-col",35)(17,"ion-row")(18,"ion-button",29),e.NdJ("click",function(){const s=e.CHM(o).$implicit,a=e.oxw(2);return e.KtG(a.cambiarEstadoReserva(s))}),e._UZ(19,"ion-icon",36),e.qZA()(),e.TgZ(20,"ion-row"),e.YNc(21,Q,2,1,"ion-icon",37),e.qZA()()()()()}if(2&r){const o=i.$implicit,t=i.index,n=e.oxw(2);e.ekj("dark-theme",n.isDarkMode),e.Q6J("ngStyle",e.VKq(10,K,n.coloresFilas[t%n.coloresFilas.length])),e.xp6(7),e.hij(" ",n.formatFechaHora(o.fechaHoraReserva),""),e.xp6(4),e.hij(" ",o.numPax,""),e.xp6(4),e.hij(" ",o.notasEspeciales,""),e.xp6(4),e.Tol(n.getEstadoColor(o.estadoReserva)),e.Q6J("name","ellipse"),e.xp6(2),e.Q6J("ngIf",null==o?null:o.id_cliente)}}function B(r,i){1&r&&(e.TgZ(0,"div"),e._uU(1," No hay reservas disponibles. "),e.qZA())}function L(r,i){if(1&r){const o=e.EpF();e.TgZ(0,"ion-content")(1,"ion-title",8),e._uU(2,"Lista de Reservas"),e.qZA(),e.TgZ(3,"ion-item")(4,"ion-label"),e._uU(5,"Mes:"),e.qZA(),e.TgZ(6,"ion-select",9),e.NdJ("ngModelChange",function(n){e.CHM(o);const s=e.oxw();return e.KtG(s.filtroMes=n)}),e.TgZ(7,"ion-select-option",10),e._uU(8,"Enero"),e.qZA(),e.TgZ(9,"ion-select-option",11),e._uU(10,"Febrero"),e.qZA(),e.TgZ(11,"ion-select-option",12),e._uU(12,"Marzo"),e.qZA(),e.TgZ(13,"ion-select-option",13),e._uU(14,"Abril"),e.qZA(),e.TgZ(15,"ion-select-option",14),e._uU(16,"Mayo"),e.qZA(),e.TgZ(17,"ion-select-option",15),e._uU(18,"Junio"),e.qZA(),e.TgZ(19,"ion-select-option",16),e._uU(20,"Julio"),e.qZA(),e.TgZ(21,"ion-select-option",17),e._uU(22,"Agosto"),e.qZA(),e.TgZ(23,"ion-select-option",18),e._uU(24,"Septiembre"),e.qZA(),e.TgZ(25,"ion-select-option",19),e._uU(26,"Octubre"),e.qZA(),e.TgZ(27,"ion-select-option",20),e._uU(28,"Noviembre"),e.qZA(),e.TgZ(29,"ion-select-option",21),e._uU(30,"Diciembre"),e.qZA()(),e.YNc(31,Y,2,0,"ion-button",22),e.qZA(),e.TgZ(32,"ion-item")(33,"ion-label"),e._uU(34,"A\xf1o:"),e.qZA(),e.TgZ(35,"ion-select",23),e.NdJ("ngModelChange",function(n){e.CHM(o);const s=e.oxw();return e.KtG(s.filtroAnio=n)}),e.TgZ(36,"ion-select-option",24),e._uU(37,"2023"),e.qZA(),e.TgZ(38,"ion-select-option",25),e._uU(39,"2024"),e.qZA(),e.TgZ(40,"ion-select-option",26),e._uU(41,"2025"),e.qZA()(),e.YNc(42,j,2,0,"ion-button",22),e.qZA(),e.TgZ(43,"ion-button",27),e.NdJ("click",function(){e.CHM(o);const n=e.oxw();return e.KtG(n.aplicarFiltros())}),e._uU(44,"Aplicar Filtros"),e.qZA(),e.YNc(45,$,22,12,"ion-card",28)(46,B,2,0,"div",1),e.qZA()}if(2&r){const o=e.oxw();e.xp6(6),e.Q6J("ngModel",o.filtroMes),e.xp6(25),e.Q6J("ngIf",o.filtroMes),e.xp6(4),e.Q6J("ngModel",o.filtroAnio),e.xp6(7),e.Q6J("ngIf",o.filtroAnio),e.xp6(3),e.Q6J("ngForOf",o.reservasFiltradas),e.xp6(),e.Q6J("ngIf",!o.reservas||0===o.reservas.length)}}const V=[{path:"",component:(()=>{var r;class i{constructor(t,n,s,a,u,d,x,g,M){this.alertController=t,this.popoverController=n,this.router=s,this.authService=a,this.usuariosService=u,this.menuService=d,this.clientesService=x,this.reservasService=g,this.themeService=M,this.filtroMes=null,this.filtroAnio=null,this.coloresFilas=["#FFECBA","#FFFFFF"],this.getUserRole(),this.isDarkMode=this.themeService.isDarkTheme(),function U(r=0,i=P){return r<0&&(r=0),function S(r=0,i,o=w){let t=-1;return null!=i&&((0,E.K)(i)?o=i:t=i),new F.y(n=>{let s=function G(r){return r instanceof Date&&!isNaN(r)}(r)?+r-o.now():r;s<0&&(s=0);let a=0;return o.schedule(function(){n.closed||(n.next(a++),0<=t?this.schedule(void 0,t):n.complete())},s)})}(r,r,i)}(3e5).subscribe(()=>{this.verificarYEliminarReservasExpiradas()}),this.getReservas()}ngOnInit(){this.componentes=this.menuService.getMenuOpts(),setInterval(()=>{this.verificarYEliminarReservasExpiradas()},6e4)}getReservas(){if("administrador"===this.rol||"encargado"===this.rol||"camarero"===this.rol){const t=this.authService.getUserEmail();null!==t?this.usuariosService.getIdEmpresaPorEmail(t).subscribe(n=>{if(200===n.code&&n.data&&n.data.id_empresa){this.idEmpresa=n.data.id_empresa;const s=this.idEmpresa;isNaN(s)?console.error("ID de empresa no es un n\xfamero v\xe1lido:",s):this.reservasService.getReservasPorEmpresa(s).subscribe(a=>{200===a.code&&Array.isArray(a.data)?(this.reservas=a.data,this.reservasFiltradas=a.data,console.log("Reservas obtenidas:",this.reservas)):console.error("La respuesta del servicio de reservas no es v\xe1lida:",a)},a=>{console.error("Error al obtener las reservas:",a)})}else console.error("No se pudo obtener el id_empresa del usuario:",n)},n=>{console.error("Error al obtener el id_empresa del usuario:",n)}):console.error("El email del usuario es nulo.")}else console.error("No tiene permiso para acceder a esta opci\xf3n.")}aplicarFiltros(){this.reservasFiltradas=this.reservas.filter(t=>{const n=new Date(t.fechaHoraReserva),s=(n.getMonth()+1).toString().padStart(2,"0"),a=n.getFullYear().toString(),u=this.filtroMes?this.filtroMes.padStart(2,"0"):null,d=this.filtroAnio?this.filtroAnio:null;return!(u&&s!==u||d&&a!==d)}),console.log("Reservas filtradas:",this.reservasFiltradas)}borrarFiltro(){this.filtroAnio="",this.filtroMes="",this.aplicarFiltros()}formatFechaHora(t){var n;const s=new f.uU("en-US");return t&&!isNaN(new Date(t).getTime())&&null!==(n=s.transform(t,"dd/MM/yyyy HH:mm"))&&void 0!==n?n:""}cambiarEstadoReserva(t){var n=this;return(0,m.Z)(function*(){console.log("Cambiando estado de reserva:",t);const a=[{estado:"pendiente",color:"#ff830f"},{estado:"aceptada",color:"#008000"},{estado:"cancelada",color:"#FF0000"}].map(d=>({text:d.estado.charAt(0).toUpperCase()+d.estado.slice(1),handler:()=>{console.log("Cambiando estado:",d.estado),n.reservasService.editarEstadoReserva(t.id_reserva,d.estado).subscribe(g=>{console.log("Actualizada estado de reserva:",g),n.reservas=n.reservas.filter(M=>M.id_reserva!==t.id_reserva),n.reservas.push({...t,estadoReserva:g.nuevoEstado,estadoColor:d.color}),n.actualizarReservaLocalStorage(t),window.location.reload()},g=>{console.error("Error al actualizar reserva en la base de datos:",g)})}}));yield(yield n.alertController.create({header:"Cambiar Estado",buttons:a})).present()})()}mostrarDetallesCliente(t,n){var s=this;return(0,m.Z)(function*(){try{const a=null==n?void 0:n.id_cliente;if(a){yield new Promise(d=>setTimeout(d,1e3));const u=yield s.clientesService.getClientePorId(a).toPromise();u?yield(yield s.popoverController.create({component:I.m,event:t,componentProps:{cliente:u},translucent:!0,backdropDismiss:!1})).present():console.error("No se pudieron obtener los detalles del cliente para la reserva:",n)}else console.error("ID del cliente no definido en la reserva:",n)}catch(a){console.error("Error al obtener detalles del cliente:",a)}})()}obtenerEstadoColor(t,n){const s=t.estadoReserva.toLowerCase();return{estado:s,color:this.getEstadoColor(s)}}getEstadoColor(t){switch(t){case"pendiente":default:return"color-naranja";case"aceptada":return"color-verde";case"cancelada":return"color-rojo"}}actualizarReservaLocalStorage(t){const n=JSON.parse(localStorage.getItem("reservas")||"[]"),s=n.findIndex(a=>a.id_reserva&&a.id_reserva===t.id_reserva);-1!==s&&(n[s].estadoReserva=t.estadoReserva,n[s].estadoColor=t.estadoColor,localStorage.setItem("reservas",JSON.stringify(n)))}verificarYEliminarReservasExpiradas(){var t=this;this.reservas.forEach(function(){var s=(0,m.Z)(function*(a){const u=new Date(a.fechaHoraReserva).getTime();(new Date).getTime()-u>6e4&&(yield t.reservasService.borrarReserva(a.id_reserva),console.log(`Eliminando reserva expirada de la base de datos: ${a.id_reserva}`),window.location.reload())});return function(a){return s.apply(this,arguments)}}())}getUserRole(){this.rol=this.authService.getUserRole(),"administrador"===this.rol||"encargado"===this.rol||"camarero"===this.rol||this.authService.logout().subscribe(()=>{localStorage.removeItem("role"),localStorage.removeItem("usuario"),this.router.navigate(["/inicio"])},t=>{console.error("Error al cerrar sesi\xf3n:",t)})}toggleDarkMode(){this.isDarkMode=!this.isDarkMode,this.themeService.setDarkTheme(this.isDarkMode)}cerrarSesion(){this.authService.logout().subscribe()}}return(r=i).\u0275fac=function(t){return new(t||r)(e.Y36(l.Br),e.Y36(l.Dh),e.Y36(p.F0),e.Y36(O.e),e.Y36(k.J),e.Y36(N.h),e.Y36(J.Y),e.Y36(D.U),e.Y36(z.f))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-gestion-reservas"]],viewQuery:function(t,n){if(1&t&&e.Gf(q,5),2&t){let s;e.iGM(s=e.CRH())&&(n.idEmpresaInput=s.first)}},inputs:{cliente:"cliente"},decls:2,vars:2,consts:[[3,"class",4,"ngIf"],[4,"ngIf"],["slot","start"],["defaultHref","/home",2,"--color","#ff830f"],["slot","end"],[3,"click"],[2,"color","#ff830f","font-size","24px",3,"name"],["name","log-out-outline","size","large",1,"color-salir"],[1,"title"],["placeholder","Selecciona mes",3,"ngModel","ngModelChange"],["value","01"],["value","02"],["value","03"],["value","04"],["value","05"],["value","06"],["value","07"],["value","08"],["value","09"],["value","10"],["value","11"],["value","12"],["fill","clear",3,"click",4,"ngIf"],["placeholder","Selecciona a\xf1o",3,"ngModel","ngModelChange"],["value","2023"],["value","2024"],["value","2025"],[1,"btnFiltro",3,"click"],[3,"dark-theme","ngStyle",4,"ngFor","ngForOf"],["fill","clear",3,"click"],["name","close-circle-outline"],[3,"ngStyle"],[2,"color","black"],["size","6"],[1,"reserva-dato"],["size","6",1,"ion-text-center"],[2,"margin-left","5px",3,"name"],["name","eye-outline","style","font-size: 20px; cursor: pointer; margin-left: 5px;color: #ff830f;",3,"click",4,"ngIf"],["name","eye-outline",2,"font-size","20px","cursor","pointer","margin-left","5px","color","#ff830f",3,"click"]],template:function(t,n){1&t&&e.YNc(0,H,11,3,"ion-header",0)(1,L,47,6,"ion-content",1),2&t&&(e.Q6J("ngIf","administrador"===n.rol||"encargado"===n.rol||"camarero"===n.rol),e.xp6(),e.Q6J("ngIf","administrador"===n.rol||"encargado"===n.rol||"camarero"===n.rol))},dependencies:[f.sg,f.O5,f.PC,_.JJ,_.On,l.YG,l.Sm,l.PM,l.FN,l.wI,l.W2,l.Gu,l.gu,l.Ie,l.Q$,l.Nd,l.t9,l.n0,l.wd,l.sr,l.QI,l.oU],styles:['@charset "UTF-8";ion-toolbar[_ngcontent-%COMP%], ion-title[_ngcontent-%COMP%], ion-col[_ngcontent-%COMP%]{font-size:2vw}ion-title[_ngcontent-%COMP%]{text-align:center}.color-salir[_ngcontent-%COMP%]{color:#ff830f}.color-naranja[_ngcontent-%COMP%]{color:orange}.color-verde[_ngcontent-%COMP%]{color:green}.color-rojo[_ngcontent-%COMP%]{color:red}.iconos[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.5vw;color:#ff830f;overflow:visible}.tabla-centrada[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:100%}.fila-bordes[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #E0E0E0;border-radius:10px;overflow:hidden;display:flex;justify-content:space-between;align-items:center;width:90vw;color:#000!important;margin-bottom:8px}.encabezado-naranja[_ngcontent-%COMP%]{color:#ff830f!important}.columna[_ngcontent-%COMP%]{flex:1;text-align:center;padding:10px}.iconos[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;flex:1}.iconos[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.5vw}.dark-theme[_ngcontent-%COMP%]{filter:none}@media screen and (max-width: 768px){ion-title.tabla-centrada[_ngcontent-%COMP%]{font-size:3vw}.columna[_ngcontent-%COMP%], .iconos[_ngcontent-%COMP%]{flex:1;font-size:2.5vw}ion-icon[_ngcontent-%COMP%]{font-size:4vw}}.estado-reserva-dot[_ngcontent-%COMP%]{width:20px;height:20px;background-size:cover;border-radius:50%}.ion-text-center[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%}ion-row.ion-text-center[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:20px}ion-title[_ngcontent-%COMP%]{font-size:20px}.title[_ngcontent-%COMP%]{font-size:20px;font-weight:700;margin-top:20px;margin-bottom:20px}label[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:#ff830f}p[_ngcontent-%COMP%]{font-size:15px;font-weight:700;text-align:center}.btnFiltro[_ngcontent-%COMP%]{margin-left:98px;border-radius:15px;font-size:12px;padding:5px 10px}']}),i})()}];let W=(()=>{var r;class i{}return(r=i).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[p.Bz.forChild(V),p.Bz]}),i})(),X=(()=>{var r;class i{}return(r=i).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[f.ez,_.u5,l.Pc,W]}),i})()}}]);