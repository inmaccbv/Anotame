"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1769],{1769:($,A,d)=>{d.r(A),d.d(A,{AddempleadosPageModule:()=>V});var v=d(6814),n=d(6223),a=d(878),b=d(9634),x=d(5861),Z=d(7398),k=d(6306),C=d(2096),e=d(9212),q=d(2759),I=d(2333),P=d(2042),M=d(2471);function T(o,s){if(1&o){const r=e.EpF();e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),e._UZ(3,"ion-back-button",3),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"A\xf1adir Empleado"),e.qZA(),e.TgZ(6,"ion-buttons",4)(7,"ion-button",5),e.NdJ("click",function(){e.CHM(r);const i=e.oxw();return e.KtG(i.toggleDarkMode())}),e._UZ(8,"ion-icon",6),e.qZA(),e.TgZ(9,"ion-button",5),e.NdJ("click",function(){e.CHM(r);const i=e.oxw();return e.KtG(i.cerrarSesion())}),e._UZ(10,"ion-icon",7),e.qZA()()()()}if(2&o){const r=e.oxw();e.Tol(r.isDarkMode?"dark-theme":""),e.xp6(8),e.Q6J("name",r.isDarkMode?"sunny-outline":"moon-outline")}}function U(o,s){1&o&&(e.TgZ(0,"ion-label",23),e._uU(1," Nombre requerido "),e.qZA())}function J(o,s){1&o&&(e.TgZ(0,"ion-label",23),e._uU(1," Apellido requerido "),e.qZA())}function E(o,s){1&o&&(e.TgZ(0,"ion-label",23),e._uU(1," Email requerido "),e.qZA())}function F(o,s){1&o&&(e.TgZ(0,"ion-label",23),e._uU(1," Email no valido "),e.qZA())}function D(o,s){1&o&&(e.TgZ(0,"ion-label",23),e._uU(1," Rol requerido "),e.qZA())}function N(o,s){1&o&&(e.TgZ(0,"ion-label",23),e._uU(1," Contrase\xf1a requerido "),e.qZA())}function Q(o,s){1&o&&(e.TgZ(0,"ion-label",23),e._uU(1," Longitud minima de 6 caracteres "),e.qZA())}function K(o,s){1&o&&(e.TgZ(0,"ion-label",23),e._uU(1," Confirmar Contrase\xf1a "),e.qZA())}function w(o,s){1&o&&(e.TgZ(0,"ion-label",23),e._uU(1," Los password no coinciden "),e.qZA())}const m=o=>({"dark-mode":o}),g=o=>({"dark-mode-label":o}),p=o=>({"dark-mode-input":o});function y(o,s){if(1&o){const r=e.EpF();e.TgZ(0,"ion-content")(1,"form",8),e.NdJ("ngSubmit",function(){e.CHM(r);const i=e.oxw();return e.KtG(i.enviarDatos())}),e._UZ(2,"input",9),e.TgZ(3,"ion-item",10)(4,"ion-label",11),e._uU(5,"Nombre Empleado"),e.qZA(),e._UZ(6,"ion-input",12),e.qZA(),e.YNc(7,U,2,0,"ion-label",13),e.TgZ(8,"ion-item",10)(9,"ion-label",11),e._uU(10,"Apellido Empleado"),e.qZA(),e._UZ(11,"ion-input",14),e.qZA(),e.YNc(12,J,2,0,"ion-label",13),e.TgZ(13,"ion-item",10)(14,"ion-label",11),e._uU(15,"Email Empleado"),e.qZA(),e._UZ(16,"ion-input",15),e.qZA(),e.YNc(17,E,2,0,"ion-label",13)(18,F,2,0,"ion-label",13),e.TgZ(19,"ion-item",10)(20,"ion-label",11),e._uU(21,"Selecciona Rol"),e.qZA(),e.TgZ(22,"ion-select",16)(23,"ion-select-option",17),e._uU(24,"Encargado"),e.qZA(),e.TgZ(25,"ion-select-option",18),e._uU(26,"Camarero"),e.qZA()()(),e.YNc(27,D,2,0,"ion-label",13),e.TgZ(28,"ion-item",10)(29,"ion-label",11),e._uU(30,"Contrase\xf1a"),e.qZA(),e._UZ(31,"ion-input",19),e.qZA(),e.YNc(32,N,2,0,"ion-label",13)(33,Q,2,0,"ion-label",13),e.TgZ(34,"ion-item",10)(35,"ion-label",11),e._uU(36,"Confirmar Contrase\xf1a"),e.qZA(),e._UZ(37,"ion-input",20),e.YNc(38,K,2,0,"ion-label",13)(39,w,2,0,"ion-label",13),e.qZA(),e.TgZ(40,"ion-row")(41,"ion-col")(42,"ion-button",21),e.NdJ("click",function(){e.CHM(r);const i=e.oxw();return e.KtG(i.enviarDatos())}),e.TgZ(43,"a",22),e._uU(44," A\xf1adir empleado "),e.qZA()()()()()()}if(2&o){const r=e.oxw();e.xp6(),e.Q6J("formGroup",r.ionicForm),e.xp6(),e.Q6J("value",r.id_empresa),e.xp6(),e.Q6J("ngClass",e.VKq(29,m,r.isDarkMode)),e.xp6(),e.Q6J("ngClass",e.VKq(31,g,r.isDarkMode)),e.xp6(2),e.Q6J("ngClass",e.VKq(33,p,r.isDarkMode)),e.xp6(),e.Q6J("ngIf",null!=r.f.nombre.getError("required")),e.xp6(),e.Q6J("ngClass",e.VKq(35,m,r.isDarkMode)),e.xp6(),e.Q6J("ngClass",e.VKq(37,g,r.isDarkMode)),e.xp6(2),e.Q6J("ngClass",e.VKq(39,p,r.isDarkMode)),e.xp6(),e.Q6J("ngIf",null!=r.f.apellido.getError("required")),e.xp6(),e.Q6J("ngClass",e.VKq(41,m,r.isDarkMode)),e.xp6(),e.Q6J("ngClass",e.VKq(43,g,r.isDarkMode)),e.xp6(2),e.Q6J("ngClass",e.VKq(45,p,r.isDarkMode)),e.xp6(),e.Q6J("ngIf",null!=r.f.email.getError("required")),e.xp6(),e.Q6J("ngIf",null!=r.f.email.getError("pattern")),e.xp6(),e.Q6J("ngClass",e.VKq(47,m,r.isDarkMode)),e.xp6(),e.Q6J("ngClass",e.VKq(49,g,r.isDarkMode)),e.xp6(2),e.Q6J("ngClass",e.VKq(51,p,r.isDarkMode)),e.xp6(5),e.Q6J("ngIf",null!=r.f.rol.getError("required")),e.xp6(),e.Q6J("ngClass",e.VKq(53,m,r.isDarkMode)),e.xp6(),e.Q6J("ngClass",e.VKq(55,g,r.isDarkMode)),e.xp6(2),e.Q6J("ngClass",e.VKq(57,p,r.isDarkMode)),e.xp6(),e.Q6J("ngIf",null!=r.f.password.getError("required")),e.xp6(),e.Q6J("ngIf",null!=r.f.password.getError("minLength")),e.xp6(),e.Q6J("ngClass",e.VKq(59,m,r.isDarkMode)),e.xp6(),e.Q6J("ngClass",e.VKq(61,g,r.isDarkMode)),e.xp6(2),e.Q6J("ngClass",e.VKq(63,p,r.isDarkMode)),e.xp6(),e.Q6J("ngIf",null!=r.f.confirmPassword.getError("required")),e.xp6(),e.Q6J("ngIf",null!=r.f.confirmPassword.getError("Mustmatch"))}}const S=[{path:"",component:(()=>{var o;class s{constructor(t,i,c,l,u,f,_){this.formBuilder=t,this.router=i,this.alertController=c,this.userRegis=l,this.authService=u,this.menuService=f,this.themeService=_,this.submitted=!1,this.id_empresa=null,this.ionicForm=this.formBuilder.group({nombre:new n.NI("",n.kI.compose([n.kI.required])),apellido:new n.NI("",n.kI.compose([n.kI.required])),email:new n.NI("",n.kI.compose([n.kI.required,n.kI.pattern("^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$")])),password:new n.NI("",n.kI.compose([n.kI.required,n.kI.minLength(6)])),confirmPassword:new n.NI("",n.kI.compose([n.kI.required,n.kI.minLength(6)])),id_empresa:new n.NI("",n.kI.compose([n.kI.required])),rol:new n.NI("",n.kI.compose([n.kI.required]))},{validators:this.MustMatch("password","confirmPassword")}),this.getUserRole(),this.isDarkMode=this.themeService.isDarkTheme()}ngOnInit(){this.componentes=this.menuService.getMenuOpts(),this.obtenerIdUsuario().subscribe(({idEmpresa:t})=>{var i;this.id_empresa=t,null===(i=this.ionicForm.get("id_empresa"))||void 0===i||i.setValue(this.id_empresa)},t=>{console.error("Error al obtener el id del usuario y la empresa:",t)})}obtenerIdUsuario(){const t=localStorage.getItem("usuario");if(t){const c=JSON.parse(t).email;return this.userRegis.getUserAndEmpresaByEmail(c).pipe((0,Z.U)(l=>{if(l&&200===l.code&&l.data){const u=l.data.id_empresa?l.data.id_empresa:null;return this.idEmpresa=u,{idEmpresa:u}}return console.error("No se pudieron obtener los datos del usuario:",l.texto),{idUsuario:null,idEmpresa:null}}),(0,k.K)(l=>(console.error("Error al obtener datos del usuario:",l),(0,C.of)({idUsuario:null,idEmpresa:null}))))}return console.error("Usuario no encontrado en el almacenamiento local"),(0,C.of)({idUsuario:null,idEmpresa:null})}getUserRole(){this.rol=this.authService.getUserRole(),"administrador"!==this.rol&&(console.error("Usuario con rol",this.rol,"no tiene permiso para acceder a esta opci\xf3n."),this.authService.logout().subscribe(()=>{localStorage.removeItem("role"),localStorage.removeItem("usuario"),this.router.navigate(["/inicio"])},t=>{console.error("Error al cerrar sesion:",t)}))}get f(){return this.ionicForm.controls}MustMatch(t,i){return c=>{const u=c.controls[i];u.errors&&!u.errors.MustMatch||u.setErrors(c.controls[t].value!==u.value?{MustMatch:!0}:null)}}get errorControl(){return this.ionicForm.controls}alert(t){console.log(t.target),this.submitted=!0}enviarDatos(){var t,i,c,l,u,f;if(console.log("Enviando datos:",this.ionicForm.value),this.submitted=!0,this.ionicForm.invalid)return void console.log("Formulario no v\xe1lido. Deteniendo env\xedo de datos.");const _=null===(t=this.ionicForm.get("id_empresa"))||void 0===t?void 0:t.value;if(null==_)return void console.error("Id de empresa no v\xe1lido. Deteniendo env\xedo de datos.");const Y={nombre:null===(i=this.ionicForm.get("nombre"))||void 0===i?void 0:i.value,apellido:null===(c=this.ionicForm.get("apellido"))||void 0===c?void 0:c.value,email:null===(l=this.ionicForm.get("email"))||void 0===l?void 0:l.value,id_empresa:_,password:null===(u=this.ionicForm.get("password"))||void 0===u?void 0:u.value,rol:null===(f=this.ionicForm.get("rol"))||void 0===f?void 0:f.value};this.userRegis.registroUsuario(Y).subscribe(h=>{console.log("Respuesta del servidor:",h),this.registros=h,console.log("Datos de registros:",this.registros.data),console.log("Texto de registros:",this.registros.texto),console.log("Authorized de registros:",this.registros.authorized),"NO"===this.registros.authorized?(console.log("Mostrando alerta de error..."),this.mostrarAlertaNO("Error","Email ya registrado")):(console.log("Mostrando alerta de \xe9xito..."),this.mostrarAlertaOK("Enhorabuena","Usuario creado correctamente"))},h=>{console.error("Error en la solicitud:",h),console.log("Mostrando alerta de error en la solicitud..."),this.mostrarAlertaNO("Error","Email ya registrado")})}mostrarAlertaOK(t,i){var c=this;return(0,x.Z)(function*(){yield(yield c.alertController.create({header:"Empleado creado correctamente",message:"Se ha enviado email ha empleado",buttons:["OK"],cssClass:"custom-alert-header"})).present()})()}mostrarAlertaNO(t,i){var c=this;return(0,x.Z)(function*(){yield(yield c.alertController.create({header:"Error",message:"Empleado ya existe",buttons:["OK"],cssClass:"custom-alert-header"})).present()})()}toggleDarkMode(){this.isDarkMode=!this.isDarkMode,this.themeService.setDarkTheme(this.isDarkMode)}cerrarSesion(){this.authService.logout().subscribe()}}return(o=s).\u0275fac=function(t){return new(t||o)(e.Y36(n.qu),e.Y36(b.F0),e.Y36(a.Br),e.Y36(q.J),e.Y36(I.e),e.Y36(P.h),e.Y36(M.f))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-addempleados"]],decls:2,vars:2,consts:[[3,"class",4,"ngIf"],[4,"ngIf"],["slot","start"],["defaultHref","/config-empleados",2,"--color","#ff830f"],["slot","end"],[3,"click"],[2,"color","#ff830f",3,"name"],["name","log-out-outline","size","large",1,"color-salir"],[3,"formGroup","ngSubmit"],["type","hidden","formControlName","id_empresa",3,"value"],["lines","full",3,"ngClass"],["position","floating",3,"ngClass"],["type","text","formControlName","nombre",3,"ngClass"],["class","errormessage","position","floating",4,"ngIf"],["type","text","formControlName","apellido",3,"ngClass"],["type","text","formControlName","email",3,"ngClass"],["type","select","formControlName","rol",3,"ngClass"],["value","encargado"],["value","camarero"],["type","password","formControlName","password",3,"ngClass"],["type","password","formControlName","confirmPassword",3,"ngClass"],[1,"custom-button",3,"click"],["href","/config-empleados",2,"color","#fff"],["position","floating",1,"errormessage"]],template:function(t,i){1&t&&e.YNc(0,T,11,3,"ion-header",0)(1,y,45,65,"ion-content",1),2&t&&(e.Q6J("ngIf","administrador"===i.rol),e.xp6(),e.Q6J("ngIf","administrador"===i.rol))},dependencies:[v.mk,v.O5,n._Y,n.Fj,n.JJ,n.JL,a.YG,a.Sm,a.wI,a.W2,a.Gu,a.gu,a.pK,a.Ie,a.Q$,a.Nd,a.t9,a.n0,a.wd,a.sr,a.QI,a.j9,a.oU,n.sg,n.u],styles:['@charset "UTF-8";form[_ngcontent-%COMP%]{margin:20px}p[_ngcontent-%COMP%]{font-family:Lato}.errormessage[_ngcontent-%COMP%]{color:red;font-size:12px}input.ng-touched.ng-invalid[_ngcontent-%COMP%]{border:1px solid red}ion-title[_ngcontent-%COMP%]{text-align:center}.color-salir[_ngcontent-%COMP%]{color:#ff830f}ion-button.custom-button[_ngcontent-%COMP%]{background-color:#ff830f;color:#fff;border-radius:10px}.dark-mode[_ngcontent-%COMP%]{background-color:#333;color:#000!important}.dark-mode-label[_ngcontent-%COMP%], .dark-mode-input[_ngcontent-%COMP%]{color:#fff!important}.custom-alert-header[_ngcontent-%COMP%]{color:#ff830f!important}']}),s})()}];let O=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[b.Bz.forChild(S),b.Bz]}),s})(),V=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[M.f],imports:[v.ez,n.u5,a.Pc,n.UX,O]}),s})()}}]);