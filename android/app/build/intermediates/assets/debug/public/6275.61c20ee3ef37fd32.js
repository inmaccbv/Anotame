"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6275],{6275:(J,f,r)=>{r.r(f),r.d(f,{DescripcionLocalPageModule:()=>k});var m=r(6814),l=r(6223),s=r(878),p=r(9634),x=r(7398),v=r(6306),h=r(2096),o=r(9212),_=r(3681),P=r(2333),M=r(2759),b=r(2042),D=r(2471);function T(t,a){if(1&t){const n=o.EpF();o.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),o._UZ(3,"ion-back-button",3),o.qZA(),o.TgZ(4,"ion-title"),o._uU(5,"Descripci\xf3n Local"),o.qZA(),o.TgZ(6,"ion-buttons",4)(7,"ion-button",5),o.NdJ("click",function(){o.CHM(n);const i=o.oxw();return o.KtG(i.toggleDarkMode())}),o._UZ(8,"ion-icon",6),o.qZA(),o.TgZ(9,"ion-button",7),o.NdJ("click",function(){o.CHM(n);const i=o.oxw();return o.KtG(i.cerrarSesion())}),o._UZ(10,"ion-icon",8),o.qZA()()()()}if(2&t){const n=o.oxw();o.Tol(n.isDarkMode?"dark-header":""),o.xp6(8),o.Q6J("name",n.isDarkMode?"sunny-outline":"moon-outline")}}function Z(t,a){1&t&&(o.TgZ(0,"div",22),o._uU(1," Nombre Restaurante es obligatorio. "),o.qZA())}function L(t,a){1&t&&(o.TgZ(0,"div",22),o._uU(1," Texto no v\xe1lido. "),o.qZA())}function U(t,a){if(1&t&&(o.TgZ(0,"div")(1,"div",17)(2,"p",18),o._uU(3),o.qZA()(),o.TgZ(4,"div",23)(5,"p",20),o._uU(6),o.qZA()()()),2&t){const n=a.$implicit;o.xp6(3),o.Oqu(n.nomLocal),o.xp6(3),o.Oqu(n.texto)}}const C=t=>({"dark-theme":t});function O(t,a){if(1&t){const n=o.EpF();o.TgZ(0,"ion-content",9)(1,"form",10),o.NdJ("ngSubmit",function(){o.CHM(n);const i=o.oxw();return o.KtG(i.enviarTexto())}),o.TgZ(2,"ion-item"),o._UZ(3,"ion-input",11),o.qZA(),o.TgZ(4,"ion-item"),o._UZ(5,"ion-textarea",12),o.qZA(),o._UZ(6,"input",13)(7,"input",14),o.TgZ(8,"ion-button",15),o._uU(9,"Enviar"),o.qZA()(),o.YNc(10,Z,2,0,"div",16)(11,L,2,0,"div",16),o.TgZ(12,"div",17)(13,"p",18),o._uU(14),o.qZA()(),o.TgZ(15,"div",19)(16,"p",20),o._uU(17),o.qZA()(),o.YNc(18,U,7,2,"div",21),o.qZA()}if(2&t){const n=o.oxw();let e,i,u,c;o.Tol(o.VKq(10,C,n.isDarkMode)),o.xp6(),o.Q6J("formGroup",n.ionicForm),o.xp6(5),o.Q6J("value",n.id_empresa),o.xp6(),o.Q6J("value",n.id_user),o.xp6(3),o.Q6J("ngIf",(null==(e=n.ionicForm.get("nomLocal"))?null:e.invalid)&&(null==(e=n.ionicForm.get("nomLocal"))?null:e.touched)),o.xp6(),o.Q6J("ngIf",(null==(i=n.ionicForm.get("texto"))?null:i.invalid)&&(null==(i=n.ionicForm.get("texto"))?null:i.touched)),o.xp6(3),o.Oqu(null==(u=n.ionicForm.get("nomLocal"))?null:u.value),o.xp6(3),o.Oqu(null==(c=n.ionicForm.get("texto"))?null:c.value),o.xp6(),o.Q6J("ngForOf",n.textosFiltrados)}}const S=[{path:"",component:(()=>{var t;class a{constructor(e,i,u,c,g,d,E){this.router=e,this.formBuilder=i,this.textoService=u,this.authService=c,this.usuariosService=g,this.menuService=d,this.themeService=E,this.id_empresa=null,this.id_user=null,this.getUserRole(),this.isDarkMode=this.themeService.isDarkTheme(),this.ionicForm=this.formBuilder.group({nomLocal:["",[l.kI.required]],texto:[""],id_empresa:[""],id_user:[""]})}ngOnInit(){this.componentes=this.menuService.getMenuOpts(),this.obtenerIdUsuario().subscribe(({idUsuario:e,idEmpresa:i})=>{this.id_user=e,this.id_empresa=i,this.getTexto()},e=>{console.error("Error al obtener el id del usuario y la empresa:",e)})}obtenerIdUsuario(){const e=localStorage.getItem("usuario");if(e){const u=JSON.parse(e).email;return this.usuariosService.getUserAndEmpresaByEmail(u).pipe((0,x.U)(c=>{if(c&&200===c.code&&c.data){const g=c.data.id_user?c.data.id_user:null,d=c.data.id_empresa?c.data.id_empresa:null;return this.idEmpresa=d,{idUsuario:g,idEmpresa:d}}return console.error("No se pudieron obtener los datos del usuario:",c.texto),{idUsuario:null,idEmpresa:null}}),(0,v.K)(c=>(console.error("Error al obtener datos del usuario:",c),(0,h.of)({idUsuario:null,idEmpresa:null}))))}return console.error("Usuario no encontrado en el almacenamiento local"),(0,h.of)({idUsuario:null,idEmpresa:null})}getUserRole(){this.rol=this.authService.getUserRole(),"administrador"!==this.rol&&(console.error("Usuario con rol",this.rol,"no tiene permiso para acceder a esta opci\xf3n."),this.authService.logout().subscribe(()=>{localStorage.removeItem("role"),localStorage.removeItem("usuario"),this.router.navigate(["/login"])},e=>{console.error("Error al cerrar sesion:",e)}))}enviarTexto(){if(this.ionicForm.valid)if(null!==this.id_empresa&&null!==this.id_user){const e={...this.ionicForm.value,id_empresa:this.id_empresa,id_user:this.id_user};this.textoService.subirTexto(e,this.id_empresa,this.id_user).subscribe(i=>{this.ionicForm.reset(),this.getTexto()},i=>{console.error("Error en la solicitud:",i)})}else console.error("No se pudo obtener el id de la empresa o el id del usuario.")}getTexto(){null!==this.idEmpresa?this.textoService.getTextosByEmpresa(this.idEmpresa).subscribe(e=>{200===e.code?(this.textos=e.data,this.textosFiltrados=e.data,console.log("Textos obtenidos:",this.textos)):console.error("Error en la respuesta:",e.texto)},e=>{console.error("Error al obtener los textos:",e)}):console.error("ID de empresa no v\xe1lido.")}toggleDarkMode(){this.isDarkMode=!this.isDarkMode,this.themeService.setDarkTheme(this.isDarkMode)}cerrarSesion(){this.authService.logout().subscribe()}}return(t=a).\u0275fac=function(e){return new(e||t)(o.Y36(p.F0),o.Y36(l.qu),o.Y36(_.r),o.Y36(P.e),o.Y36(M.J),o.Y36(b.h),o.Y36(D.f))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-descripcion-local"]],decls:2,vars:2,consts:[[3,"class",4,"ngIf"],["class","custom-content",3,"class",4,"ngIf"],["slot","start"],["defaultHref","/home",2,"--color","#ff830f"],["slot","end"],[1,"custom-button",3,"click"],[2,"color","#ff830f","font-size","24px",3,"name"],["size","large",1,"color-salir",3,"click"],["name","log-out-outline"],[1,"custom-content"],[3,"formGroup","ngSubmit"],["formControlName","nomLocal","placeholder","Introduce nombre local","rows","5"],["formControlName","texto","placeholder","Introduce texto","rows","10"],["type","hidden","formControlName","id_empresa",3,"value"],["type","hidden","formControlName","id_user",3,"value"],["type","submit",1,"custom-button"],["class","error-message",4,"ngIf"],[2,"overflow-wrap","break-word","max-width","350px","color","#ff830f"],[2,"font-size","25px"],[2,"overflow-wrap","break-word","max-width","350px"],[1,"white-text",2,"font-size","20px"],[4,"ngFor","ngForOf"],[1,"error-message"],[2,"overflow-wrap","break-word","max-width","350px","white-space","pre-line","margin-bottom","10px"]],template:function(e,i){1&e&&o.YNc(0,T,11,3,"ion-header",0)(1,O,19,12,"ion-content",1),2&e&&(o.Q6J("ngIf","administrador"===i.rol),o.xp6(),o.Q6J("ngIf","administrador"===i.rol))},dependencies:[m.sg,m.O5,l._Y,l.Fj,l.JJ,l.JL,s.YG,s.Sm,s.W2,s.Gu,s.gu,s.pK,s.Ie,s.g2,s.wd,s.sr,s.j9,s.oU,l.sg,l.u],styles:["ion-content.custom-content.dark-theme[_ngcontent-%COMP%]{--background: #444852 !important;color:#fff}ion-content.custom-content[_ngcontent-%COMP%]{--background: #ffffff;color:#343541;--padding-start: 20px !important;--padding-end: 20px !important;--padding-top: 20px !important;--padding-bottom: 20px !important;margin:10px!important}ion-content.custom-content.dark-theme[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{color:#fff}ion-content.custom-content.dark-theme[_ngcontent-%COMP%]   p.white-text[_ngcontent-%COMP%]{color:#fff}ion-content.custom-content[_ngcontent-%COMP%]   .custom-button[_ngcontent-%COMP%]{--color: #ffffff}ion-title[_ngcontent-%COMP%]{text-align:center}.dark-theme[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{color:#fff}.dark-theme[_ngcontent-%COMP%]   p.white-text[_ngcontent-%COMP%]{color:#fff}.color-salir[_ngcontent-%COMP%]{color:#ff830f!important}.custom-button[_ngcontent-%COMP%], .dark-theme[_ngcontent-%COMP%]   .custom-button[_ngcontent-%COMP%]{--color: #ffffff}label[_ngcontent-%COMP%]{font-size:large;color:#ff830f;font-weight:700;display:block;margin-bottom:10px}"]}),a})()}];let F=(()=>{var t;class a{}return(t=a).\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[p.Bz.forChild(S),p.Bz]}),a})(),k=(()=>{var t;class a{}return(t=a).\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[m.ez,l.u5,s.Pc,l.UX,F]}),a})()}}]);