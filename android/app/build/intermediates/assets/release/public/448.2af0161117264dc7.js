"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[448],{448:(A,v,a)=>{a.r(v),a.d(v,{ReviewscliPageModule:()=>y});var m=a(6814),d=a(6223),l=a(878),f=a(9634),P=a(7398),M=a(6306),h=a(2096),e=a(9212),C=a(1762),x=a(2333),k=a(9306),w=a(1660),O=a(1770),R=a(2471);const b=["idEmpresaInput"];function S(i,c){if(1&i){const o=e.EpF();e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),e._UZ(3,"ion-back-button",3),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"Rese\xf1as"),e.qZA(),e.TgZ(6,"ion-buttons",4)(7,"ion-button",5),e.NdJ("click",function(){e.CHM(o);const n=e.oxw();return e.KtG(n.toggleDarkMode())}),e._UZ(8,"ion-icon",6),e.qZA(),e.TgZ(9,"ion-button",5),e.NdJ("click",function(){e.CHM(o);const n=e.oxw();return e.KtG(n.cerrarSesion())}),e._UZ(10,"ion-icon",7),e.qZA()()()()}if(2&i){const o=e.oxw();e.Tol(o.isDarkMode?"dark-theme":""),e.xp6(4),e.Udp("color",o.isDarkMode?"#ff830f":""),e.xp6(4),e.Q6J("name",o.isDarkMode?"sunny-outline":"moon-outline")}}function E(i,c){if(1&i){const o=e.EpF();e.TgZ(0,"ion-icon",18),e.NdJ("click",function(){const s=e.CHM(o).index,r=e.oxw(2);return e.KtG(r.calificar(s+1))}),e.qZA()}if(2&i){const o=c.$implicit;e.Udp("color",o.color),e.Q6J("name",o.icon)}}function Z(i,c){if(1&i){const o=e.EpF();e.TgZ(0,"a",5),e.NdJ("click",function(){e.CHM(o);const n=e.oxw(3);return e.KtG(n.toggleExpansion())}),e._uU(1,"Ver m\xe1s"),e.qZA()}}function T(i,c){if(1&i){const o=e.EpF();e.TgZ(0,"a",5),e.NdJ("click",function(){e.CHM(o);const n=e.oxw(3);return e.KtG(n.toggleExpansion())}),e._uU(1,"Ver menos"),e.qZA()}}function U(i,c){if(1&i&&(e.TgZ(0,"ion-card",11)(1,"ion-card-content",19)(2,"p"),e._uU(3),e._UZ(4,"ion-icon",20),e.qZA(),e.TgZ(5,"p",21),e._uU(6),e.qZA(),e.TgZ(7,"div",22),e.YNc(8,Z,2,0,"a",23)(9,T,2,0,"a",23),e.qZA()()()),2&i){const o=c.$implicit,t=e.oxw(2);e.ekj("dark-theme",t.isDarkMode),e.xp6(3),e.hij("",o.calificacion," "),e.xp6(2),e.ekj("expandido",t.expandido),e.xp6(),e.hij(" ",o.comentario," "),e.xp6(2),e.Q6J("ngIf",!t.expandido&&o.comentario.length>100),e.xp6(),e.Q6J("ngIf",t.expandido)}}function I(i,c){if(1&i){const o=e.EpF();e.TgZ(0,"ion-content",8)(1,"form",9),e.NdJ("ngSubmit",function(){e.CHM(o);const n=e.oxw();return e.KtG(n.enviarResena())}),e.TgZ(2,"ion-item")(3,"ion-label"),e._uU(4,"Calificaci\xf3n"),e.qZA(),e.YNc(5,E,1,3,"ion-icon",10),e.qZA(),e.TgZ(6,"ion-item",11)(7,"ion-label",12),e._uU(8,"Comentario"),e.qZA(),e._UZ(9,"ion-textarea",13),e.qZA(),e._UZ(10,"input",14,15)(12,"input",14),e.TgZ(13,"ion-button",16),e._uU(14,"Enviar Rese\xf1a"),e.qZA()(),e.YNc(15,U,10,8,"ion-card",17),e.qZA()}if(2&i){const o=e.oxw();let t;e.xp6(),e.Q6J("formGroup",o.reviewForm),e.xp6(),e.ekj("dark-theme",o.isDarkMode),e.xp6(3),e.Q6J("ngForOf",o.stars),e.xp6(),e.ekj("dark-theme",o.isDarkMode),e.xp6(4),e.Q6J("value",o.idEmpresa),e.xp6(2),e.Q6J("value",(null==(t=o.reviewForm.get("id_cliente"))?null:t.value)||""),e.xp6(),e.Udp("color","#fff"),e.xp6(2),e.Q6J("ngForOf",o.reviewsFiltrados)}}const F=[{path:"",component:(()=>{var i;class c{constructor(t,n,s,r,g,_,p,u){this.router=t,this.formBuilder=n,this.reviewsService=s,this.authService=r,this.clienteService=g,this.authServiceCli=_,this.menuCli=p,this.themeService=u,this.expandido=!1,this.stars=[],this.resenas=[],this.getUserRole(),this.isDarkMode=this.themeService.isDarkTheme(),this.inicializarEstrellas(),this.obtenerDatosUsuario(),this.reviewForm=this.formBuilder.group({id_cliente:[""],id_empresa:[""],calificacion:[0,d.kI.required],comentario:["",d.kI.required]})}ngOnInit(){this.componentes=this.menuCli.getMenuOptsCli();const t=localStorage.getItem("id_empresa");this.idEmpresa=t?parseInt(t,10):null,this.idEmpresa&&this.getReviews(this.idEmpresa)}inicializarEstrellas(){this.stars=Array(5).fill({icon:"star-outline",color:"medium"})}calificar(t){var n;null===(n=this.reviewForm.get("calificacion"))||void 0===n||n.setValue(t),this.stars=this.stars.map((s,r)=>({icon:r<t?"star":"star-outline",color:r<t?"warning":"medium"}))}obtenerIdCliente(){const t=localStorage.getItem("cliente");if(t){const s=JSON.parse(t).email;return this.clienteService.getUserByEmail(s).pipe((0,P.U)(r=>(console.log("Respuesta del servidor en obtenerIdCliente:",r),r&&200===r.code&&r.data?r.data.id_cliente?r.data.id_cliente.toString():null:(console.error("No se pudieron obtener los datos del usuario:",r.texto),null))),(0,M.K)(r=>(console.error("Error al obtener datos del usuario:",r),(0,h.of)(null))))}return console.error("Usuario no encontrado en el almacenamiento local"),(0,h.of)(null)}enviarResena(){this.reviewForm.valid?this.obtenerIdCliente().subscribe(t=>{if(t){var n,s;const r=localStorage.getItem("id_empresa"),p={id_cliente:t,id_empresa:r?parseInt(r,10):null,calificacion:null===(n=this.reviewForm.get("calificacion"))||void 0===n?void 0:n.value,comentario:null===(s=this.reviewForm.get("comentario"))||void 0===s?void 0:s.value};this.reviewsService.subirResena(p).subscribe(u=>{setTimeout(()=>{window.location.reload()},500)},u=>{console.error("Error al enviar la rese\xf1a:",u)})}else console.error("Id_cliente no encontrado.")},t=>{console.error("Error al obtener el id_cliente:",t)}):console.error("El formulario de rese\xf1a no es v\xe1lido.")}obtenerDatosUsuario(){const t=localStorage.getItem("cliente");if(!t)return void console.error("Usuario no encontrado en el almacenamiento local");const s=JSON.parse(t).email;this.clienteService.getUserByEmail(s).subscribe(r=>{r&&200===r.code&&r.data?(this.clienteData=r.data,this.getReviews(r.data.id_cliente)):console.error("No se pudieron obtener los datos del usuario:",r.texto)},r=>{console.error("Error al obtener datos del usuario:",r)})}getReviews(t){null!==this.idEmpresa?this.reviewsService.getReviewsByEmpresa(this.idEmpresa).subscribe(n=>{"code"in n?200===n.code?"data"in n?(this.reviews=n.data,this.reviewsFiltrados=n.data):console.error('Error en la respuesta: Propiedad "data" no encontrada.'):console.error("Error en la respuesta:",n.reviews):console.error('Error en la respuesta: Propiedad "code" no encontrada.')},n=>{console.error("Error al obtener los textos:",n)}):console.error("ID de empresa no v\xe1lido.")}eliminarResena(t){this.resenas.splice(t,1),localStorage.setItem("resenas",JSON.stringify(this.resenas))}getUserRole(){this.rol=this.authServiceCli.getUserRole(),"cliente"!==this.rol&&(console.error("Cliente con rol",this.rol,"no tiene permiso para acceder a esta opci\xf3n."),this.authServiceCli.logout().subscribe(()=>{localStorage.removeItem("role"),localStorage.removeItem("usuario"),this.router.navigate(["/inicio"])},t=>{console.error("Error al cerrar sesi\xf3n:",t)}))}toggleExpansion(){this.expandido=!this.expandido}toggleDarkMode(){this.isDarkMode=!this.isDarkMode,this.themeService.setDarkTheme(this.isDarkMode)}cerrarSesion(){this.authServiceCli.logout().subscribe()}}return(i=c).\u0275fac=function(t){return new(t||i)(e.Y36(f.F0),e.Y36(d.qu),e.Y36(C.Y),e.Y36(x.e),e.Y36(k.Y),e.Y36(w.S),e.Y36(O.g),e.Y36(R.f))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-reviewscli"]],viewQuery:function(t,n){if(1&t&&e.Gf(b,5),2&t){let s;e.iGM(s=e.CRH())&&(n.idEmpresaInput=s.first)}},decls:2,vars:2,consts:[[3,"class",4,"ngIf"],["class","ion-padding",4,"ngIf"],["slot","start"],["defaultHref","/homecli",2,"--color","#ff830f"],["slot","end"],[3,"click"],[2,"color","#ff830f","font-size","24px",3,"name"],["name","log-out-outline","size","large",1,"color-salir"],[1,"ion-padding"],[3,"formGroup","ngSubmit"],[3,"name","color","click",4,"ngFor","ngForOf"],[2,"margin-top","30px"],["position","floating"],["formControlName","comentario",2,"height","10em"],["type","hidden",3,"value"],["idEmpresaInput",""],["type","submit","expand","block","name","submit"],["style","margin-top: 30px;",3,"dark-theme",4,"ngFor","ngForOf"],[3,"name","click"],[2,"display","flex","flex-direction","column"],["name","star",2,"color","#ff830f"],[1,"comentario-preview"],[2,"margin-top","5px","margin-left","auto","text-align","right"],[3,"click",4,"ngIf"]],template:function(t,n){1&t&&e.YNc(0,S,11,5,"ion-header",0)(1,I,16,11,"ion-content",1),2&t&&(e.Q6J("ngIf","cliente"===n.rol),e.xp6(),e.Q6J("ngIf","cliente"===n.rol))},dependencies:[m.sg,m.O5,d._Y,d.JJ,d.JL,l.YG,l.Sm,l.PM,l.FN,l.W2,l.Gu,l.gu,l.Ie,l.Q$,l.g2,l.wd,l.sr,l.j9,l.oU,d.sg,d.u],styles:['@charset "UTF-8";body[_ngcontent-%COMP%]{font-size:16px}.comentario-preview[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-height:1.5em}.expandido[_ngcontent-%COMP%]{max-height:unset!important;overflow:unset!important;white-space:pre-wrap}a[_ngcontent-%COMP%]{cursor:pointer;color:#ff830f}.custom-trash-icon[_ngcontent-%COMP%]{float:right;color:#fff;margin-bottom:20px}.star-icon[_ngcontent-%COMP%]{font-size:24px;color:gold}label[_ngcontent-%COMP%], ion-label[_ngcontent-%COMP%], p[_ngcontent-%COMP%], ion-card-title[_ngcontent-%COMP%]{color:#000}ion-card-title[_ngcontent-%COMP%]{font-size:2.2em}ion-card-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.5em}ion-icon[_ngcontent-%COMP%], ion-text[_ngcontent-%COMP%]{color:#ff830f!important}.dark-theme[_ngcontent-%COMP%]{--background: #444852;--color: #ffffff;--dark-background-color: #333;--dark-text-color: #fff;--dark-border-color: #555}.dark-theme[_ngcontent-%COMP%]   ion-content[_ngcontent-%COMP%]{--background: #444852;color:#fff}.dark-theme[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%], .dark-theme[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{--background: #343541}.dark-theme[_ngcontent-%COMP%]   ion-list.md.list-md.hydrated[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%], .dark-theme[_ngcontent-%COMP%]   .list-md[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: #343541;color:#fff;border:none}.dark-theme[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%], .dark-theme[_ngcontent-%COMP%]   ion-buttonitem[_ngcontent-%COMP%], .dark-theme[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{--background: #444852;color:#fff}.dark-theme[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{--background: var(--dark-background-color);--color: var(--dark-text-color)}.dark-theme[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .dark-theme[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], .dark-theme[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff!important}.dark-theme[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:2.2em}ion-title[_ngcontent-%COMP%]{text-align:center}']}),c})()}];let J=(()=>{var i;class c{}return(i=c).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.Bz.forChild(F),f.Bz]}),c})(),y=(()=>{var i;class c{}return(i=c).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[m.ez,d.u5,l.Pc,d.UX,J]}),c})()}}]);