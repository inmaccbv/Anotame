"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7282],{7282:(z,g,c)=>{c.r(g),c.d(g,{ListaemprPageModule:()=>J});var u=c(6814),h=c(6223),a=c(878),m=c(9634),d=c(5861),f=c(6232),v=c(9397),P=c(6306),e=c(9212),_=c(5038),E=c(2759),C=c(4484),L=c(2333),T=c(2096);let M=(()=>{var r;class l{constructor(o){this.router=o,this.BASE_RUTA="http://localhost/anotame/APIANOTAME/public/",this.RUTA_EMPRESA="Empresas"}logout(){return localStorage.removeItem("role"),localStorage.removeItem("darkMode"),localStorage.removeItem("usuario"),window.location.href="/login",(0,T.of)(!0)}}return(r=l).\u0275fac=function(o){return new(o||r)(e.LFG(m.F0))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),l})();var Z=c(2471),b=c(2042);const w=["empresaRow"];function x(r,l){if(1&r){const n=e.EpF();e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",17),e._UZ(3,"ion-back-button",18),e.qZA(),e.TgZ(4,"ion-title",19),e._uU(5,"Lista Empleados"),e.qZA(),e.TgZ(6,"ion-buttons",20)(7,"ion-button",21),e.NdJ("click",function(){e.CHM(n);const t=e.oxw();return e.KtG(t.toggleDarkMode())}),e._UZ(8,"ion-icon",22),e.qZA(),e.TgZ(9,"ion-button",21),e.NdJ("click",function(){e.CHM(n);const t=e.oxw();return e.KtG(t.cerrarSesion())}),e._UZ(10,"ion-icon",23),e.qZA()()()()}if(2&r){const n=e.oxw();e.Tol(n.isDarkMode?"dark-theme":""),e.xp6(8),e.Q6J("name",n.isDarkMode?"sunny-outline":"moon-outline")}}function O(r,l){if(1&r&&(e.TgZ(0,"ion-select-option",24),e._uU(1),e.qZA()),2&r){const n=l.$implicit;e.Q6J("value",n.id_empresa),e.xp6(),e.Oqu(n.empresa)}}function F(r,l){if(1&r&&(e.TgZ(0,"ion-select-option",24),e._uU(1),e.qZA()),2&r){const n=l.$implicit;e.Q6J("value",n.provincia),e.xp6(),e.Oqu(n.provincia)}}const A=r=>({"background-color":r});function I(r,l){if(1&r&&(e.TgZ(0,"ion-card",26)(1,"ion-card-content")(2,"ion-row")(3,"ion-label",27),e._uU(4,"NOMBRE"),e.qZA(),e.TgZ(5,"p"),e._uU(6),e.qZA()(),e.TgZ(7,"ion-row")(8,"ion-label",27),e._uU(9,"APELLIDO"),e.qZA(),e.TgZ(10,"p"),e._uU(11),e.qZA()(),e.TgZ(12,"ion-row")(13,"ion-label",27),e._uU(14,"CORREO ELECTR\xd3NICO"),e.qZA(),e.TgZ(15,"p"),e._uU(16),e.qZA()(),e.TgZ(17,"ion-row"),e._UZ(18,"input",28),e._uU(19),e.qZA()()()),2&r){const n=l.$implicit,o=l.index,t=e.oxw(2);e.Q6J("ngStyle",e.VKq(5,A,t.coloresFilas[o%t.coloresFilas.length])),e.xp6(6),e.Oqu(n.nombre),e.xp6(5),e.Oqu(n.apellido),e.xp6(5),e.Oqu(n.email),e.xp6(3),e.hij("",n.id_user," ")}}function S(r,l){if(1&r&&(e.TgZ(0,"ion-list"),e.YNc(1,I,20,7,"ion-card",25),e.qZA()),2&r){const n=e.oxw();e.xp6(),e.Q6J("ngForOf",n.empleados)}}const U=[{path:"",component:(()=>{var r;class l{constructor(o,t,s,i,p,N,R,q,D,Y){this.empresaService=o,this.userLogin=t,this.provinciasService=s,this.authService=i,this.authEmpresa=p,this.themeService=N,this.menuService=R,this.router=q,this.alertController=D,this.popoverController=Y,this.filtroTipoLocal="",this.usuarios=[],this.usuariosFiltrados=[],this.coloresFilas=["#FFECBA","#FFFFFF"],this.empleados=[],this.getUserRole(),console.log("Rol obtenido:",this.rol),this.isDarkMode=this.themeService.isDarkTheme()}ngOnInit(){this.componentes=this.menuService.getMenuOpts(),this.getProvincias();const o=localStorage.getItem("usuario");if(o){const s=JSON.parse(o).email;this.obtenerIdEmpresaPorEmail(s),this.userLogin.getEmpleados().subscribe(i=>{this.usuarios=i,console.log("Usuarios obtenidos:",this.usuarios),null!==this.idEmpresa&&this.filtrarUsuariosPorIdEmpresa(this.idEmpresa)},i=>{console.error("Error al obtener usuarios:",i)})}else console.error("Usuario no encontrado en el localStorage")}obtenerIdEmpresaPorEmail(o){this.userLogin.getIdEmpresaPorEmail(o).subscribe(t=>{null!==t?(this.idEmpresa=t,console.log("ID de Empresa:",t),this.filtrarUsuariosPorIdEmpresa(t)):console.error("No se pudo obtener el ID de Empresa.")},t=>{console.error("Error al obtener el ID de Empresa:",t)})}filtrarUsuariosPorIdEmpresa(o){console.log("Filtrando usuarios por id_empresa:",o),console.log("Usuarios antes de filtrar:",this.usuarios),this.usuariosFiltrados=this.usuarios.filter(t=>t.id_empresa===o),console.log("Usuarios filtrados:",this.usuariosFiltrados)}getUserRole(){this.rol=this.authService.getUserRole(),console.log(this.rol),"administrador"!==this.rol&&(console.error("Usuario con rol",this.rol,"no tiene permiso para acceder a esta opci\xf3n."),this.authService.logout().subscribe(()=>{localStorage.removeItem("role"),localStorage.removeItem("usuario"),this.router.navigate(["/inicio"])},o=>{console.error("Error al cerrar sesi\xf3n:",o)}))}getEmpleados(){this.userLogin.getEmpleados().subscribe(o=>{this.empleados2=o,this.empleadosFiltrados=o,console.log("Empleados obtenidos:",this.empleados2)},o=>{console.error("Error al obtener empleados:",o)})}getEmpleadosPorEmpresa(o){return this.empresaService.getEmpleadosPorEmpresa(o).pipe((0,v.b)(t=>{this.empleados=t,this.empleadosFiltrados=t,console.log("Empleados obtenidos:",this.empleados)}),(0,P.K)(t=>(console.error("Error al obtener empleados:",t),f.E)))}getEmpresas(){this.empresaService.getEmpresas().subscribe(o=>{this.empresas=o,console.log("Empresas obtenidas:",this.empresas),this.empresasFiltrados=this.empresas},o=>{console.error("Error al obtener empresas:",o)})}getProvincias(){var o=this;this.provinciasService.getProvincias().subscribe(function(){var t=(0,d.Z)(function*(s){o.provincias=s});return function(s){return t.apply(this,arguments)}}())}borrarEmpresa(o){var t=this;return(0,d.Z)(function*(){yield(yield t.alertController.create({header:"Confirmar",message:"\xbfEst\xe1s seguro de que deseas borrar este empleado?",buttons:[{text:"Cancelar",role:"cancel",handler:()=>{console.log("Borrado cancelado")}},{text:"Borrar",handler:()=>{try{t.empresaService.borrarEmpresa(o).subscribe(function(){var i=(0,d.Z)(function*(p){console.log(p),window.location.reload()});return function(p){return i.apply(this,arguments)}}())}catch(i){console.error(i)}}}]})).present()})()}getUsuarioInfo(o){const t=this.empresasFiltrados.find(s=>s.id_empresa===o.id_empresa);return t?{empresa:t.empresa,provincia:t.provincia}:{empresa:"",provincia:""}}filtrarEmpresa(o,t){const s=t.target.value||"";this.empresasFiltrados=this.empresas.filter(i=>{const p=s.toLowerCase();switch(o){case"empresa":return i.empresa.toLowerCase().includes(p);case"ciudad":return i.ciudad.toLowerCase().includes(p);case"tipoLocal":return i.tipoLocal.toLowerCase().includes(p);default:return i.empresa.toLowerCase().includes(p)||i.ciudad.toLowerCase().includes(p)||i.tipoLocal.toLowerCase().includes(p)}}),this.filtroTipoLocal&&(this.empresasFiltrados=this.empresasFiltrados.filter(i=>i.tipoLocal.toLowerCase().includes(this.filtroTipoLocal.toLowerCase())))}filtrarPorEmpresaProvincia(){this.empresasFiltrados=this.empresas.filter(o=>{const t=!this.filtroEmpresa||o.id_empresa===this.filtroEmpresa,s=!this.filtroProvincia||this.getUsuarioInfo(o).provincia===this.filtroProvincia;return t&&s})}onEmpresaChange(o){this.filtroEmpresa=o.detail.value,this.filtrarPorEmpresaProvincia()}onProvinciaChange(o){this.filtroProvincia=o.detail.value,this.filtrarPorEmpresaProvincia()}onMostrarTodosEmpresas(){this.filtroEmpresa=null,this.filtrarPorEmpresaProvincia()}onMostrarTodosProvincias(){this.filtroProvincia=null,this.filtrarPorEmpresaProvincia()}onTipoLocalChange(o){this.filtroTipoLocal=o.detail.value,this.aplicarFiltros()}aplicarFiltros(){this.empresasFiltrados=this.empresas.filter(o=>{const t=!this.filtroEmpresa||o.id_empresa===this.filtroEmpresa,s=!this.filtroProvincia||this.getUsuarioInfo(o).provincia===this.filtroProvincia,i=!this.filtroTipoLocal||o.tipoLocal.toLowerCase().includes(this.filtroTipoLocal.toLowerCase());return t&&s&&i})}toggleDarkMode(){this.isDarkMode=!this.isDarkMode,this.themeService.setDarkTheme(this.isDarkMode);const o=document.querySelector("ion-content");o&&o.classList.toggle("dark-mode",this.isDarkMode)}cerrarSesion(){this.authEmpresa.logout().subscribe()}}return(r=l).\u0275fac=function(o){return new(o||r)(e.Y36(_.P),e.Y36(E.J),e.Y36(C.g),e.Y36(L.e),e.Y36(M),e.Y36(Z.f),e.Y36(b.h),e.Y36(m.F0),e.Y36(a.Br),e.Y36(a.Dh))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-listaempr"]],viewQuery:function(o,t){if(1&o&&e.Gf(w,5),2&o){let s;e.iGM(s=e.CRH())&&(t.empresaRows=s)}},decls:26,vars:4,consts:[[3,"class",4,"ngIf"],[2,"margin-left","5px"],["placeholder","Buscar por restaurante",3,"ionInput"],["placeholder","Buscar por ciudad",3,"ionInput"],[2,"text-align","center","margin-left","45px"],["size","6"],["placeholder","Restaurantes",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],["placeholder","Provincias",3,"ionChange"],["placeholder","Tipo de Local",3,"ionChange"],["value",""],["value","Italiano"],["value","Mexicano"],["value","Asi\xe1tico"],["value","Mediterr\xe1neo"],["value","Indio"],[4,"ngIf"],["slot","start"],["defaultHref","/config-empleados",2,"--color","#ff830f"],["color","primary",2,"font-size","20px"],["slot","end"],[3,"click"],[2,"color","#ff830f","font-size","22px",3,"name"],["name","log-out-outline","size","large",1,"color-salir"],[3,"value"],[3,"ngStyle",4,"ngFor","ngForOf"],[3,"ngStyle"],[2,"font-weight","bold"],["type","number"]],template:function(o,t){1&o&&(e.YNc(0,x,11,3,"ion-header",0),e.TgZ(1,"ion-content",1)(2,"ion-searchbar",2),e.NdJ("ionInput",function(i){return t.filtrarEmpresa("empresa",i)}),e.qZA(),e.TgZ(3,"ion-searchbar",3),e.NdJ("ionInput",function(i){return t.filtrarEmpresa("ciudad",i)}),e.qZA(),e.TgZ(4,"ion-row",4)(5,"ion-col",5)(6,"ion-select",6),e.NdJ("ionChange",function(i){return t.onEmpresaChange(i)}),e.YNc(7,O,2,2,"ion-select-option",7),e.qZA()(),e.TgZ(8,"ion-col",5)(9,"ion-select",8),e.NdJ("ionChange",function(i){return t.onProvinciaChange(i)}),e.YNc(10,F,2,2,"ion-select-option",7),e.qZA()(),e.TgZ(11,"ion-col",5)(12,"ion-select",9),e.NdJ("ionChange",function(i){return t.onTipoLocalChange(i)}),e.TgZ(13,"ion-select-option",10),e._uU(14,"Mostrar Todos"),e.qZA(),e.TgZ(15,"ion-select-option",11),e._uU(16,"Italiano"),e.qZA(),e.TgZ(17,"ion-select-option",12),e._uU(18,"Mexicano"),e.qZA(),e.TgZ(19,"ion-select-option",13),e._uU(20,"Asi\xe1tico"),e.qZA(),e.TgZ(21,"ion-select-option",14),e._uU(22,"Mediterr\xe1neo"),e.qZA(),e.TgZ(23,"ion-select-option",15),e._uU(24,"Indio"),e.qZA()()()(),e.YNc(25,S,2,1,"ion-list",16),e.qZA()),2&o&&(e.Q6J("ngIf","administrador"===t.rol),e.xp6(7),e.Q6J("ngForOf",t.empresas),e.xp6(3),e.Q6J("ngForOf",t.provincias),e.xp6(15),e.Q6J("ngIf","administrador"===t.rol))},dependencies:[u.sg,u.O5,u.PC,a.YG,a.Sm,a.PM,a.FN,a.wI,a.W2,a.Gu,a.gu,a.Q$,a.q_,a.Nd,a.VI,a.t9,a.n0,a.wd,a.sr,a.QI,a.j9,a.oU],styles:['@charset "UTF-8";@font-face{font-family:restaurant;src:url(restaurant.1b01a82eee17a8b3.ttf) format("truetype");font-weight:400;font-style:normal}ion-toolbar[_ngcontent-%COMP%]{font-size:20px}.color-salir[_ngcontent-%COMP%]{color:#ff830f}ion-title[_ngcontent-%COMP%]{text-align:center}ion-label[_ngcontent-%COMP%], p[_ngcontent-%COMP%]{margin-left:20px;margin-right:40px;font-family:cakecafe,sans-serif;color:#000}p[_ngcontent-%COMP%]{font-size:17px}.iconos[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .eye-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.5vw;color:#ff830f;overflow:visible}.tabla-ancha[_ngcontent-%COMP%]{width:100%;margin:auto}.fila-bordes[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #e0e0e0;border-radius:10px;overflow:hidden;display:flex;justify-content:space-between;align-items:center;width:100%;color:#000!important;text-align:center;font-weight:700}.encabezado-naranja[_ngcontent-%COMP%]{flex:1;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.columna[_ngcontent-%COMP%], .columna-cif[_ngcontent-%COMP%]{flex:1;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.columna-cif[_ngcontent-%COMP%]{flex:2}.fila-bordes[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden}.iconos[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.5vw;overflow:visible}.dark-theme[_ngcontent-%COMP%]{filter:none}@media screen and (max-width: 768px){ion-toolbar[_ngcontent-%COMP%]{font-size:3vw}.columna[_ngcontent-%COMP%], .iconos[_ngcontent-%COMP%]{flex:1;font-size:2.5vw}ion-icon[_ngcontent-%COMP%]{font-size:4vw}}']}),l})()}];let y=(()=>{var r;class l{}return(r=l).\u0275fac=function(o){return new(o||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[m.Bz.forChild(U),m.Bz]}),l})(),J=(()=>{var r;class l{}return(r=l).\u0275fac=function(o){return new(o||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[u.ez,h.u5,a.Pc,y]}),l})()}}]);