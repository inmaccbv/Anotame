"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2405],{2405:(E,h,c)=>{c.r(h),c.d(h,{GestionSalaPageModule:()=>T});var m=c(6814),v=c(6223),l=c(878),d=c(9634),t=c(9212),p=c(2333),f=c(9862);const S=["myCanvas"],P=[{path:"",component:(()=>{var a;class r{constructor(e,n){this.authService=e,this.http=n,this.isDragging=!1,this.draggedImageIndex=-1,this.mesasWidth=100,this.mesasHeight=80,this.images=[],this.BASE_RUTA="http://localhost/anotame/APIANOTAME/public/"}ngAfterViewInit(){this.initializeCanvas()}initializeCanvas(){this.ctx=this.canvas.nativeElement.getContext("2d"),this.canvas.nativeElement.width=800,this.canvas.nativeElement.height=600,this.ctx.fillStyle="#D7D6D6",this.ctx.fillRect(0,0,this.canvas.nativeElement.width,this.canvas.nativeElement.height),this.canvas.nativeElement.addEventListener("touchstart",e=>this.onTouchStart(e)),this.canvas.nativeElement.addEventListener("touchmove",e=>this.onTouchMove(e)),this.canvas.nativeElement.addEventListener("touchend",()=>this.onTouchEnd())}onButtonClick(e){const n=new Image;n.src=e,n.onload=()=>{this.images.push({image:e,x:0,y:0}),this.drawImage()}}drawImage(){this.ctx.clearRect(0,0,this.canvas.nativeElement.width,this.canvas.nativeElement.height),this.images.forEach(e=>{const n=new Image;n.src=e.image,this.ctx.drawImage(n,e.x,e.y,this.mesasWidth,this.mesasHeight)})}onTouchStart(e){const n=this.canvas.nativeElement.getBoundingClientRect(),s=e.touches[0].clientX-n.left,i=e.touches[0].clientY-n.top;for(let o=this.images.length-1;o>=0;o--){const u=this.images[o];if(s>=u.x&&s<=u.x+this.mesasWidth&&i>=u.y&&i<=u.y+this.mesasHeight){const _=s-u.x,x=i-u.y;this.isDragging=!0,this.draggedImageIndex=o,this.images[o].offsetX=_,this.images[o].offsetY=x;break}}}onTouchMove(e){if(this.isDragging&&-1!==this.draggedImageIndex){const n=this.canvas.nativeElement.getBoundingClientRect(),i=e.touches[0].clientY-n.top,o=this.images[this.draggedImageIndex];o.x=e.touches[0].clientX-n.left-o.offsetX,o.y=i-o.offsetY,this.drawImage()}}onTouchEnd(){this.isDragging=!1,this.draggedImageIndex=-1}guardarImagen(){this.canvas.nativeElement.toDataURL("image/png");const s=this.images.map(i=>({image:i.image,x:i.x,y:i.y}));this.http.post(this.BASE_RUTA+"ImagenController.php/guardar-posicion-imagenes",{images:s}).subscribe(i=>{console.log("Datos de posici\xf3n de im\xe1genes guardados en el servidor:",i)},i=>{console.error("Error al guardar los datos de posici\xf3n de im\xe1genes en el servidor:",i)})}cerrarSesion(){this.authService.logout().subscribe()}}return(a=r).\u0275fac=function(e){return new(e||a)(t.Y36(p.e),t.Y36(f.eN))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-gestion-sala"]],viewQuery:function(e,n){if(1&e&&t.Gf(S,5),2&e){let s;t.iGM(s=t.CRH())&&(n.canvas=s.first)}},decls:20,vars:0,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],[3,"click"],["name","log-out-outline"],[3,"touchstart","touchend"],["myCanvas",""]],template:function(e,n){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5,"Gesti\xf3n Sala"),t.qZA(),t.TgZ(6,"ion-buttons",2)(7,"ion-button",3),t.NdJ("click",function(){return n.cerrarSesion()}),t._UZ(8,"ion-icon",4),t.qZA()()()(),t.TgZ(9,"ion-content")(10,"ion-button",3),t.NdJ("click",function(){return n.onButtonClick("/assets/imgMesas/mesa4.png")}),t._uU(11,"Mesa 4"),t.qZA(),t.TgZ(12,"ion-button",3),t.NdJ("click",function(){return n.onButtonClick("/assets/imgMesas/mesa6.png")}),t._uU(13,"Mesa 6"),t.qZA(),t.TgZ(14,"ion-button",3),t.NdJ("click",function(){return n.onButtonClick("/assets/imgMesas/mesa8.png")}),t._uU(15,"Mesa 8"),t.qZA(),t.TgZ(16,"canvas",5,6),t.NdJ("touchstart",function(i){return n.onTouchStart(i)})("touchend",function(){return n.onTouchEnd()}),t.qZA(),t.TgZ(18,"ion-button",3),t.NdJ("click",function(){return n.guardarImagen()}),t._uU(19,"Guardar imagen"),t.qZA()())},dependencies:[l.YG,l.Sm,l.W2,l.Gu,l.gu,l.wd,l.sr,l.oU],styles:["canvas[_ngcontent-%COMP%]{background-color:#d7d6d6;border:2px solid #000000;width:60%;margin-top:15px;margin-bottom:10px;margin-left:60px}.custom-button[_ngcontent-%COMP%]{border:2px solid #ff830f;width:50px}.custom-icon[_ngcontent-%COMP%]{width:30px}.tooltip[_ngcontent-%COMP%]{position:absolute;top:-10px;left:50%;transform:translate(-50%);background-color:#f1f1f1;color:#333;padding:5px 10px;border-radius:5px;font-size:15px;opacity:0;transition:opacity .3s ease-in-out;white-space:normal;text-align:center}.tooltip.active[_ngcontent-%COMP%]{opacity:1}"]}),r})()}];let G=(()=>{var a;class r{}return(a=r).\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[d.Bz.forChild(P),d.Bz]}),r})(),T=(()=>{var a;class r{}return(a=r).\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[m.ez,v.u5,l.Pc,G]}),r})()}}]);