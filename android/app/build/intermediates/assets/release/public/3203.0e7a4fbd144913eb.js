"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3203],{3203:(A,p,n)=>{n.r(p),n.d(p,{CartaPageModule:()=>E});var m=n(6814),u=n(6223),l=n(878),h=n(9634),f=n(5861),x=n(7398),v=n(6306),_=n(2096),e=n(9212),b=n(3458),P=n(2333),M=n(2471),C=n(2759);function U(r,s){if(1&r){const a=e.EpF();e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),e._UZ(3,"ion-back-button",3),e.qZA(),e.TgZ(4,"ion-title",4),e._uU(5,"Carta"),e.qZA(),e.TgZ(6,"ion-buttons",5)(7,"ion-button",6),e.NdJ("click",function(){e.CHM(a);const i=e.oxw();return e.KtG(i.toggleDarkMode())}),e._UZ(8,"ion-icon",7),e.qZA(),e.TgZ(9,"ion-button",6),e.NdJ("click",function(){e.CHM(a);const i=e.oxw();return e.KtG(i.cerrarSesion())}),e._UZ(10,"ion-icon",8),e.qZA()()()()}if(2&r){const a=e.oxw();e.xp6(8),e.Q6J("name",a.isDarkMode?"sunny-outline":"moon-outline")}}const S=r=>({color:r});function Z(r,s){if(1&r){const a=e.EpF();e.TgZ(0,"ion-card",19),e._UZ(1,"img",20),e.TgZ(2,"ion-card-header")(3,"ion-card-title",21),e._uU(4),e.qZA(),e.TgZ(5,"ion-icon",22),e.NdJ("click",function(){const c=e.CHM(a).$implicit,o=e.oxw(2);return e.KtG(o.borrarImg(c.id_carta))}),e.qZA()()()}if(2&r){const a=s.$implicit,t=e.oxw(2);e.xp6(),e.s9C("alt",a.carta_img),e.Q6J("src",t.obtenerUrlImg(a),e.LSH),e.xp6(2),e.Q6J("ngStyle",e.VKq(4,S,t.isDarkMode?"white":"inherit")),e.xp6(),e.Oqu(a.carta_img)}}function T(r,s){if(1&r){const a=e.EpF();e.TgZ(0,"ion-content",9)(1,"form",10)(2,"label",11),e._uU(3,"Subir Carta"),e.qZA(),e._UZ(4,"br")(5,"input",12)(6,"input",13),e.TgZ(7,"div",14)(8,"input",15),e.NdJ("change",function(i){e.CHM(a);const c=e.oxw();return e.KtG(c.onFileSelected(i))}),e.qZA(),e.TgZ(9,"ion-button",16),e.NdJ("click",function(){e.CHM(a);const i=e.oxw();return e.KtG(i.uploadImage())}),e._uU(10,"Subir Carta"),e.qZA()()(),e.TgZ(11,"div",17),e.YNc(12,Z,6,6,"ion-card",18),e.qZA()()}if(2&r){const a=e.oxw();e.xp6(),e.Q6J("formGroup",a.formCarta),e.xp6(4),e.Q6J("value",a.id_empresa),e.xp6(),e.Q6J("value",a.id_user),e.xp6(6),e.Q6J("ngForOf",a.cartas)}}const y=[{path:"",component:(()=>{var r;class s{constructor(t,i,c,o,d,g,F){this.formBuilder=t,this.alertController=i,this.router=c,this.cartaUploadService=o,this.authService=d,this.themeService=g,this.usuariosService=F,this.BASE_RUTA="http://localhost/anotame/APIANOTAME/public/uploads",this.selectedFile=null,this.uploadedFiles=[],this.id_empresa=null,this.id_user=null,this.isDarkMode=!1,this.isDarkMode=this.themeService.isDarkTheme(),this.formCarta=this.formBuilder.group({carta_img:[""],id_empresa:[""],id_user:[""]})}ngOnInit(){this.getUserRole(),this.isDarkMode=this.themeService.isDarkTheme(),this.getImg(),this.obtenerIdUsuario().subscribe(({idUsuario:t,idEmpresa:i})=>{this.id_user=t,this.id_empresa=i,null!==this.id_empresa?this.getImg():console.error("ID de empresa no v\xe1lido.")},t=>{console.error("Error al obtener el id del usuario y la empresa:",t)})}obtenerIdUsuario(){const t=localStorage.getItem("usuario");if(t){const c=JSON.parse(t).email;return this.usuariosService.getUserAndEmpresaByEmail(c).pipe((0,x.U)(o=>o&&200===o.code&&o.data?{idUsuario:o.data.id_user?o.data.id_user:null,idEmpresa:o.data.id_empresa?o.data.id_empresa:null}:(console.error("No se pudieron obtener los datos del usuario:",o.texto),{idUsuario:null,idEmpresa:null})),(0,v.K)(o=>(console.error("Error al obtener datos del usuario:",o),(0,_.of)({idUsuario:null,idEmpresa:null}))))}return console.error("Usuario no encontrado en el almacenamiento local"),(0,_.of)({idUsuario:null,idEmpresa:null})}getUserRole(){this.rol=this.authService.getUserRole(),"administrador"===this.rol||"encargado"===this.rol||(console.error("Usuario con rol",this.rol,"no tiene permiso para acceder a esta opci\xf3n."),this.authService.logout().subscribe(()=>{localStorage.removeItem("role"),localStorage.removeItem("usuario"),this.router.navigate(["/inicio"])},t=>{console.error("Error al cerrar sesi\xf3n:",t)}))}onFileSelected(t){this.selectedFile=t.target.files[0]}uploadImage(){this.selectedFile?this.obtenerIdUsuario().subscribe(({idUsuario:t,idEmpresa:i})=>{this.id_user=t,this.id_empresa=i;const c=new FormData;this.selectedFile&&null!==this.id_empresa&&null!==this.id_user?(c.append("carta_img",this.selectedFile,this.selectedFile.name),this.cartaUploadService.uploadFile(c,this.id_empresa,this.id_user).subscribe(o=>{o&&"SI"===o.authorized&&o.url?this.uploadedFiles.push({name:o.data.carta_img,url:this.BASE_RUTA+o.data.carta_img}):console.error("Error al subir la imagen:",o),this.getImg()},o=>{console.error("Error en la solicitud:",o)})):console.error("El archivo seleccionado es nulo o faltan IDs.")},t=>{console.error("Error al obtener el id del usuario y la empresa:",t)}):console.error("No se ha seleccionado ning\xfan archivo.")}getImg(){null!==this.id_empresa&&this.cartaUploadService.getCartasByEmpresa(this.id_empresa).subscribe(t=>{"code"in t?200===t.code?"data"in t?(this.cartas=t.data,this.cartasFiltradas=t.data,console.log("Cartas obtenidas:",this.cartas)):console.error('Error en la respuesta: Propiedad "data" no encontrada.'):console.error("Error en la respuesta:",t.reviews):console.error('Error en la respuesta: Propiedad "code" no encontrada.')},t=>{console.error("Error al obtener los textos:",t)})}borrarImg(t){var i=this;return(0,f.Z)(function*(){yield(yield i.alertController.create({header:"Confirmar",message:"\xbfEst\xe1s seguro de que deseas borrar esta carta?",buttons:[{text:"Cancelar",role:"cancel",handler:()=>{console.log("Borrado cancelado")}},{text:"Borrar",handler:()=>{try{i.cartaUploadService.borrarImg(t).subscribe(function(){var o=(0,f.Z)(function*(d){console.log(d),window.location.reload()});return function(d){return o.apply(this,arguments)}}())}catch(o){console.error(o)}}}]})).present()})()}obtenerUrlImg(t){return`${this.BASE_RUTA}/${t.carta_img}`}toggleDarkMode(){this.isDarkMode=!this.isDarkMode,this.themeService.setDarkTheme(this.isDarkMode)}cerrarSesion(){this.authService.logout().subscribe()}}return(r=s).\u0275fac=function(t){return new(t||r)(e.Y36(u.qu),e.Y36(l.Br),e.Y36(h.F0),e.Y36(b.A),e.Y36(P.e),e.Y36(M.f),e.Y36(C.J))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-carta"]],decls:3,vars:2,consts:[[4,"ngIf"],["class","center-content",4,"ngIf"],["slot","start"],["defaultHref","/gestion-menu-carta",2,"--color","#ff830f"],["color","primary"],["slot","end"],[3,"click"],[2,"color","#ff830f","font-size","24px",3,"name"],["name","log-out-outline","size","large",1,"color-salir"],[1,"center-content"],[3,"formGroup"],["for","fileInput",1,"label"],["type","hidden","formControlName","id_empresa",3,"value"],["type","hidden","formControlName","id_user",3,"value"],[1,"upload-row"],["type","file","id","fileInput","accept","image/*",1,"upload-input",3,"change"],[1,"upload-button",3,"click"],[1,"gallery-container",2,"margin-left","10px","margin-right","25px"],["class","card-container",4,"ngFor","ngForOf"],[1,"card-container"],[2,"width","100%",3,"src","alt"],[1,"card-title",3,"ngStyle"],["name","trash-outline","size","small",1,"trash-icon",3,"click"]],template:function(t,i){1&t&&(e.YNc(0,U,11,1,"ion-header",0)(1,T,13,4,"ion-content",1),e._UZ(2,"router-outlet")),2&t&&(e.Q6J("ngIf","administrador"===i.rol||"encargado"===i.rol),e.xp6(),e.Q6J("ngIf","administrador"===i.rol||"encargado"===i.rol))},dependencies:[m.sg,m.O5,m.PC,u._Y,u.Fj,u.JJ,u.JL,l.YG,l.Sm,l.PM,l.Zi,l.Dq,l.W2,l.Gu,l.gu,l.wd,l.sr,l.oU,u.sg,u.u,h.lC],styles:['@charset "UTF-8";ion-title[_ngcontent-%COMP%]{text-align:center}.center-content[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;text-align:center;font-size:large;color:#ff830f;font-weight:700;margin-top:15px}.color-salir[_ngcontent-%COMP%]{color:#ff830f}ion-select[_ngcontent-%COMP%]{margin-left:15px;margin-right:15px}.upload-row[_ngcontent-%COMP%]{display:flex;align-items:center;margin-left:8px;margin-right:8px}.upload-input[_ngcontent-%COMP%]{margin-left:8px;margin-right:8px}.upload-button[_ngcontent-%COMP%]{width:120px;margin-left:15px;margin-right:15px}.card-container[_ngcontent-%COMP%]{width:100%;max-width:400px;margin-bottom:50px;position:relative;text-align:center;overflow:hidden}.card-image[_ngcontent-%COMP%]{width:calc(100% - 12px);height:auto;object-fit:contain;margin:10px auto;max-height:300px}ion-card-header[_ngcontent-%COMP%]{text-align:center;overflow:visible;display:flex;justify-content:space-between;align-items:center;white-space:nowrap;margin-top:5px;margin-bottom:5px}.card-title[_ngcontent-%COMP%]{font-size:18px;margin-left:auto;margin-right:auto;margin-bottom:2px}.trash-icon[_ngcontent-%COMP%]{color:#ff830f;cursor:pointer;margin-left:5px;margin-top:5px;font-size:30px}.dark-theme[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{--background: #444852;--color: #ffffff;--border-color: #ffffff}']}),s})()}];let I=(()=>{var r;class s{}return(r=s).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[h.Bz.forChild(y),h.Bz]}),s})(),E=(()=>{var r;class s{}return(r=s).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({providers:[C.J],imports:[m.ez,u.u5,l.Pc,u.UX,I]}),s})()}}]);