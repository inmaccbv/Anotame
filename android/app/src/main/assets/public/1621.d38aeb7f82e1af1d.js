"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1621],{1621:(w,M,s)=>{s.r(M),s.d(M,{MenuImgPageModule:()=>k});var h=s(6814),m=s(6223),l=s(878),p=s(9634),x=s(5861),I=s(7398),b=s(6306),f=s(2096),P=s(9397),e=s(9212),U=s(173),y=s(2759),S=s(828),C=s(2333),D=s(2471);function Z(o,u){if(1&o){const n=e.EpF();e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),e._UZ(3,"ion-back-button",3),e.qZA(),e.TgZ(4,"ion-title",4),e._uU(5,"Men\xfas"),e.qZA(),e.TgZ(6,"ion-buttons",5)(7,"ion-button",6),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.toggleDarkMode())}),e._UZ(8,"ion-icon",7),e.qZA(),e.TgZ(9,"ion-button",6),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.cerrarSesion())}),e._UZ(10,"ion-icon",8),e.qZA()()()()}if(2&o){const n=e.oxw();e.Tol(n.isDarkMode?"dark-theme":""),e.xp6(8),e.Q6J("name",n.isDarkMode?"sunny-outline":"moon-outline")}}function T(o,u){if(1&o&&(e.TgZ(0,"ion-select-option",21),e._uU(1),e.qZA()),2&o){const n=u.$implicit;e.Q6J("value",n),e.xp6(),e.hij(" ",n," ")}}const E=o=>({color:o});function A(o,u){if(1&o){const n=e.EpF();e.TgZ(0,"ion-card",22),e._UZ(1,"img",23),e.TgZ(2,"ion-card-header")(3,"ion-card-title",24),e._uU(4),e.qZA(),e.TgZ(5,"ion-icon",25),e.NdJ("click",function(){const c=e.CHM(n).$implicit,a=e.oxw(2);return e.KtG(a.borrarImg(c.id_menu||c.id_menu))}),e.qZA()()()}if(2&o){const n=u.$implicit,t=e.oxw(2);e.xp6(),e.s9C("alt",n.menu_img),e.Q6J("src",t.obtenerUrlImg(n),e.LSH),e.xp6(2),e.Q6J("ngStyle",e.VKq(4,E,t.isDarkMode?"white":"inherit")),e.xp6(),e.hij(" ",n.dia?""+n.dia:"D\xeda no especificado"," ")}}function F(o,u){if(1&o){const n=e.EpF();e.TgZ(0,"ion-content",9)(1,"label"),e._uU(2,"Subir Men\xfa"),e.qZA(),e._UZ(3,"br"),e.TgZ(4,"form",10)(5,"ion-select",11),e._UZ(6,"ion-icon",12),e.YNc(7,T,2,2,"ion-select-option",13),e.qZA(),e._UZ(8,"input",14)(9,"input",15),e.TgZ(10,"div",16)(11,"input",17),e.NdJ("change",function(i){e.CHM(n);const c=e.oxw();return e.KtG(c.onFileSelected(i))}),e.qZA(),e.TgZ(12,"ion-button",18),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.uploadImage())}),e._uU(13,"Subir Men\xfa"),e.qZA()(),e.TgZ(14,"div",19),e.YNc(15,A,6,6,"ion-card",20),e.qZA()()()}if(2&o){const n=e.oxw();e.xp6(4),e.Q6J("formGroup",n.form),e.xp6(),e.ekj("dark-theme",n.isDarkMode),e.xp6(2),e.Q6J("ngForOf",n.availableDays),e.xp6(),e.Q6J("value",n.id_empresa),e.xp6(),e.Q6J("value",n.id_user),e.xp6(6),e.Q6J("ngForOf",n.menus)}}const O=[{path:"",component:(()=>{var o;class u{constructor(t,i,c,a,d,r,g,_){this.router=t,this.alertController=i,this.formBuilder=c,this.menuUploadService=a,this.usuariosService=d,this.diasService=r,this.authService=g,this.themeService=_,this.BASE_RUTA="http://localhost/anotame/APIANOTAME/public/uploads",this.selectedFile=null,this.id_empresa=null,this.id_user=null,this.availableDays=[],this.isDarkMode=!1,this.isDarkMode=this.themeService.isDarkTheme(),this.form=this.formBuilder.group({dia:new m.NI("",{updateOn:"blur"}),id_empresa:[""],id_user:[""]}),this.arrImgAndDay=[]}ngOnInit(){this.getUserRole(),this.isDarkMode=this.themeService.isDarkTheme(),this.getDias().subscribe(t=>{t&&this.getImg()}),this.obtenerIdUsuario().subscribe(({idUsuario:t,idEmpresa:i})=>{this.id_user=t,this.id_empresa=i,null!==this.id_empresa?this.getImg():console.error("ID de empresa no v\xe1lido.")},t=>{console.error("Error al obtener el id del usuario y la empresa:",t)})}obtenerIdUsuario(){const t=localStorage.getItem("usuario");if(t){const c=JSON.parse(t).email;return this.usuariosService.getUserAndEmpresaByEmail(c).pipe((0,I.U)(a=>a&&200===a.code&&a.data?{idUsuario:a.data.id_user?a.data.id_user:null,idEmpresa:a.data.id_empresa?a.data.id_empresa:null}:(console.error("No se pudieron obtener los datos del usuario:",a.texto),{idUsuario:null,idEmpresa:null})),(0,b.K)(a=>(console.error("Error al obtener datos del usuario:",a),(0,f.of)({idUsuario:null,idEmpresa:null}))))}return console.error("Usuario no encontrado en el almacenamiento local"),(0,f.of)({idUsuario:null,idEmpresa:null})}getDias(){return this.diasService.getDias().pipe((0,P.b)(t=>{this.dias=t,this.availableDays=this.dias.map(i=>i.dia)}),(0,b.K)(t=>(console.error("Error al obtener los d\xedas:",t),(0,f.of)(null))))}getUserRole(){this.rol=this.authService.getUserRole(),"administrador"===this.rol||"encargado"===this.rol||(console.error("Usuario con rol",this.rol,"no tiene permiso para acceder a esta opci\xf3n."),this.authService.logout().subscribe(()=>{localStorage.removeItem("role"),localStorage.removeItem("usuario"),this.router.navigate(["/inicio"])},t=>{console.error("Error al cerrar sesi\xf3n:",t)}))}onFileSelected(t){this.selectedFile=t.target.files[0]}uploadImage(){this.selectedFile?this.obtenerIdUsuario().subscribe(({idUsuario:t,idEmpresa:i})=>{var c;const a=null===(c=this.form.get("dia"))||void 0===c?void 0:c.value;this.id_user=t,this.id_empresa=i;const d=new FormData;this.selectedFile&&null!==this.id_empresa&&null!==this.id_user?(d.append("menu_img",this.selectedFile,this.selectedFile.name),d.append("dia",a),this.menuUploadService.uploadFile(d,this.id_empresa,this.id_user).subscribe(r=>{if(r&&"SI"===r.authorized&&r.url){window.location.reload();const v=this.form.get("dia");null==v||v.disable({emitEvent:!1})}else console.error("Error al subir la imagen:",r)},r=>{console.error("Error en la solicitud:",r)})):console.error("El archivo seleccionado es nulo o faltan IDs.")},t=>{console.error("Error al obtener el id del usuario y la empresa:",t)}):console.error("No se ha seleccionado ning\xfan archivo.")}getImg(){null!==this.id_empresa&&this.menuUploadService.getMenusByEmpresa(this.id_empresa).subscribe(t=>{"code"in t?200===t.code?"data"in t?(this.menus=t.data,this.menus.sort((i,c)=>this.availableDays.indexOf(i.dia)-this.availableDays.indexOf(c.dia)),console.log("Men\xfas obtenidos:",this.menus)):console.error('Error en la respuesta: Propiedad "data" no encontrada.'):console.error("Error en la respuesta:",t.menus):console.error('Error en la respuesta: Propiedad "code" no encontrada.')},t=>{console.error("Error al obtener los men\xfas:",t)})}borrarImg(t){var i=this;return(0,x.Z)(function*(){yield(yield i.alertController.create({header:"Confirmar",message:"\xbfEst\xe1s seguro de que deseas borrar este men\xfa?",buttons:[{text:"Cancelar",role:"cancel",handler:()=>{console.log("Borrado de menu cancelado")}},{text:"Borrar",handler:()=>{try{i.menuUploadService.borrarImg(t).subscribe(function(){var a=(0,x.Z)(function*(d){i.getImg();const r=i.form.get("dia");null==r||r.enable(),null==r||r.disable({emitEvent:!1}),null==r||r.setValue(""),i.dias.push({dia:null==r?void 0:r.value,disponible:!0}),window.location.reload()});return function(d){return a.apply(this,arguments)}}())}catch(a){console.error(a)}}}]})).present()})()}obtenerUrlImg(t){return t&&t.menu_img?`${this.BASE_RUTA}/${t.menu_img}`:(console.error("La propiedad menu_img es undefined en el men\xfa:",t),"")}toggleDarkMode(){this.isDarkMode=!this.isDarkMode,this.themeService.setDarkTheme(this.isDarkMode)}cerrarSesion(){this.authService.logout().subscribe()}}return(o=u).\u0275fac=function(t){return new(t||o)(e.Y36(p.F0),e.Y36(l.Br),e.Y36(m.qu),e.Y36(U.c),e.Y36(y.J),e.Y36(S.z),e.Y36(C.e),e.Y36(D.f))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-menu-img"]],decls:2,vars:2,consts:[[3,"class",4,"ngIf"],["class","center-content",4,"ngIf"],["slot","start"],["defaultHref","/gestion-menu-carta",2,"--color","#ff830f"],["color","primary"],["slot","end"],[3,"click"],[2,"color","#ff830f","font-size","24px",3,"name"],["name","log-out-outline","size","large",1,"color-salir"],[1,"center-content"],[3,"formGroup"],["type","select","formControlName","dia","placeholder","Seleccione un d\xeda"],["name","today-outline","slot","start",2,"margin-right","8px"],[3,"value",4,"ngFor","ngForOf"],["type","hidden","formControlName","id_empresa",3,"value"],["type","hidden","formControlName","id_user",3,"value"],[1,"upload-row"],["type","file","id","fileInput","accept","image/*",1,"upload-input",3,"change"],[1,"upload-button",3,"click"],[1,"gallery-container",2,"margin-left","10px","margin-right","25px"],["class","card-container",4,"ngFor","ngForOf"],[3,"value"],[1,"card-container"],[2,"width","100%",3,"src","alt"],[1,"card-title",3,"ngStyle"],["name","trash-outline",1,"trash-icon",2,"font-size","26px","color","#ff830f","margin-top","5px",3,"click"]],template:function(t,i){1&t&&e.YNc(0,Z,11,3,"ion-header",0)(1,F,16,7,"ion-content",1),2&t&&(e.Q6J("ngIf","administrador"===i.rol||"encargado"===i.rol),e.xp6(),e.Q6J("ngIf","administrador"===i.rol||"encargado"===i.rol))},dependencies:[h.sg,h.O5,h.PC,m._Y,m.Fj,m.JJ,m.JL,l.YG,l.Sm,l.PM,l.Zi,l.Dq,l.W2,l.Gu,l.gu,l.t9,l.n0,l.wd,l.sr,l.QI,l.oU,m.sg,m.u],styles:['@charset "UTF-8";ion-title[_ngcontent-%COMP%]{text-align:center}.center-content[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;text-align:center;font-size:large;color:#ff830f;font-weight:700;margin-top:15px}.color-salir[_ngcontent-%COMP%]{color:#ff830f}ion-select[_ngcontent-%COMP%]{margin-left:15px;margin-right:15px}.upload-row[_ngcontent-%COMP%]{display:flex;align-items:center;margin-left:8px;margin-right:8px}.upload-input[_ngcontent-%COMP%]{margin-left:8px;margin-right:8px}.upload-button[_ngcontent-%COMP%]{width:120px;margin-left:15px;margin-right:15px}.card-container[_ngcontent-%COMP%]{width:100%;max-width:400px;margin-bottom:50px;position:relative;text-align:center;overflow:hidden}.card-image[_ngcontent-%COMP%]{width:calc(100% - 12px);height:auto;object-fit:contain;margin:10px auto;max-height:300px}ion-card-header[_ngcontent-%COMP%]{text-align:center;overflow:visible;display:flex;justify-content:space-between;align-items:center;white-space:nowrap;margin-top:5px;margin-bottom:5px}.card-title[_ngcontent-%COMP%]{font-size:18px;margin-left:auto;margin-right:auto;margin-bottom:2px}.trash-icon[_ngcontent-%COMP%]{cursor:pointer;margin-left:5px}.dark-theme[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{--background: #444852;--color: #ffffff;--border-color: #ffffff}ion-icon[_ngcontent-%COMP%]{margin-right:5px;font-size:20px;color:#ff830f}']}),u})()}];let J=(()=>{var o;class u{}return(o=u).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[p.Bz.forChild(O),p.Bz]}),u})(),k=(()=>{var o;class u{}return(o=u).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[h.ez,m.u5,l.Pc,m.UX,J]}),u})()}}]);