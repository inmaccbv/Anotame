"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8197],{8197:(D,x,s)=>{s.r(x),s.d(x,{HorariosPageModule:()=>k});var p=s(6814),h=s(6223),c=s(878),f=s(9634),M=s(2096),v=s(7398),b=s(6306),o=s(9212),P=s(7594),H=s(2333),S=s(2471),C=s(2759),Z=s(2042);function O(i,n){if(1&i){const r=o.EpF();o.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),o._UZ(3,"ion-back-button",3),o.qZA(),o.TgZ(4,"ion-title",4),o._uU(5,"Horarios"),o.qZA(),o.TgZ(6,"ion-buttons",5)(7,"ion-button",6),o.NdJ("click",function(){o.CHM(r);const a=o.oxw();return o.KtG(a.toggleDarkMode())}),o._UZ(8,"ion-icon",7),o.qZA(),o.TgZ(9,"ion-button",6),o.NdJ("click",function(){o.CHM(r);const a=o.oxw();return o.KtG(a.cerrarSesion())}),o._UZ(10,"ion-icon",8),o.qZA()()()()}if(2&i){const r=o.oxw();o.Tol(r.isDarkMode?"dark-theme":""),o.xp6(8),o.Q6J("name",r.isDarkMode?"sunny-outline":"moon-outline")}}function U(i,n){if(1&i){const r=o.EpF();o.TgZ(0,"ion-row")(1,"ion-col",17),o._uU(2),o.qZA(),o.TgZ(3,"ion-col",18)(4,"ion-input",19),o.NdJ("ngModelChange",function(a){const t=o.CHM(r).$implicit,l=o.oxw(2);return o.KtG(l.hora_apertura[t]=a)}),o.qZA()(),o.TgZ(5,"ion-col",18)(6,"ion-input",19),o.NdJ("ngModelChange",function(a){const t=o.CHM(r).$implicit,l=o.oxw(2);return o.KtG(l.hora_cierre[t]=a)}),o.qZA()(),o.TgZ(7,"ion-col",14)(8,"ion-button",20),o.NdJ("click",function(){const d=o.CHM(r).$implicit,t=o.oxw(2);return o.KtG(t.agregarHorario(d))}),o._UZ(9,"ion-icon",21),o.qZA()()()}if(2&i){const r=n.$implicit,e=o.oxw(2);o.xp6(2),o.Oqu(r),o.xp6(2),o.Q6J("ngModel",e.hora_apertura[r]),o.xp6(2),o.Q6J("ngModel",e.hora_cierre[r]),o.xp6(2),o.Q6J("disabled",e.diasSeleccionados.has(r))}}function T(i,n){if(1&i&&(o.ynx(0),o._uU(1),o.BQk()),2&i){const r=o.oxw().$implicit;o.xp6(),o.AsE(" ",r.hora_apertura," \u2013 ",r.hora_cierre," ")}}function A(i,n){1&i&&(o.ynx(0),o._uU(1," Cerrado "),o.BQk())}function E(i,n){if(1&i&&(o.TgZ(0,"ion-row")(1,"ion-col",17),o._uU(2),o.qZA(),o.TgZ(3,"ion-col",22),o.YNc(4,T,2,2,"ng-container",1)(5,A,2,0,"ng-container",1),o.qZA()()),2&i){const r=n.$implicit;o.xp6(2),o.Oqu(r.dia),o.xp6(2),o.Q6J("ngIf",r.hora_apertura&&r.hora_cierre),o.xp6(),o.Q6J("ngIf",!r.hora_apertura||!r.hora_cierre)}}function J(i,n){if(1&i&&(o.TgZ(0,"ion-content")(1,"form",9),o._UZ(2,"input",10)(3,"input",11),o.qZA(),o.TgZ(4,"ion-grid")(5,"ion-row",12)(6,"ion-col",13),o._uU(7,"D\xeda"),o.qZA(),o.TgZ(8,"ion-col",13),o._uU(9,"Hora de Apertura"),o.qZA(),o.TgZ(10,"ion-col",13),o._uU(11,"Hora de Cierre"),o.qZA(),o._UZ(12,"ion-col",14),o.qZA(),o.YNc(13,U,10,4,"ion-row",15),o.qZA(),o.TgZ(14,"ion-grid")(15,"ion-row",12)(16,"ion-col",13),o._uU(17,"D\xeda"),o.qZA(),o.TgZ(18,"ion-col",16),o._uU(19,"Horario"),o.qZA()(),o.YNc(20,E,6,3,"ion-row",15),o.qZA()()),2&i){const r=o.oxw();o.xp6(),o.Q6J("formGroup",r.ionicForm),o.xp6(),o.Q6J("value",r.id_empresa),o.xp6(),o.Q6J("value",r.id_user),o.xp6(),o.ekj("dark-text",r.isDarkMode),o.xp6(9),o.Q6J("ngForOf",r.diasSemana),o.xp6(),o.ekj("dark-text",r.isDarkMode),o.xp6(6),o.Q6J("ngForOf",r.horariosSeleccionados)}}const w=[{path:"",component:(()=>{var i;class n{constructor(e,a,d,t,l,u,g){this.formBuilder=e,this.router=a,this.horariosService=d,this.authService=t,this.themeService=l,this.usuariosService=u,this.menuService=g,this.id_empresa=null,this.id_user=null,this.diasSemana=["Lunes","Martes","Mi\xe9rcoles","Jueves","Viernes","S\xe1bado","Domingo"],this.diasSeleccionados=new Set,this.cerradoMostrado={},this.horariosSeleccionados=[],this.hora_apertura={},this.hora_cierre={},this.ionicForm=this.formBuilder.group({id_empresa:[""],id_user:[""]}),this.getUserRole(),this.isDarkMode=this.themeService.isDarkTheme()}ngOnInit(){this.componentes=this.menuService.getMenuOpts(),this.obtenerIdUsuario().subscribe(({idUsuario:e,idEmpresa:a})=>{this.id_user=e,this.id_empresa=a,null!==this.id_empresa?(this.initHorariosPredeterminados(),this.getHorarios()):console.error("ID de empresa no v\xe1lido.")},e=>{console.error("Error al obtener el id del usuario y la empresa:",e)})}obtenerIdUsuario(){const e=localStorage.getItem("usuario");if(e){const d=JSON.parse(e).email;return this.usuariosService.getUserAndEmpresaByEmail(d).pipe((0,v.U)(t=>t&&200===t.code&&t.data?{idUsuario:t.data.id_user?t.data.id_user:null,idEmpresa:t.data.id_empresa?t.data.id_empresa:null}:(console.error("No se pudieron obtener los datos del usuario:",t.texto),{idUsuario:null,idEmpresa:null})),(0,b.K)(t=>(console.error("Error al obtener datos del usuario:",t),(0,M.of)({idUsuario:null,idEmpresa:null}))))}return console.error("Usuario no encontrado en el almacenamiento local"),(0,M.of)({idUsuario:null,idEmpresa:null})}getUserRole(){this.rol=this.authService.getUserRole(),"administrador"===this.rol||"encargado"===this.rol||(console.error("Usuario con rol",this.rol,"no tiene permiso para acceder a esta opci\xf3n."),this.authService.logout().subscribe(()=>{localStorage.removeItem("role"),localStorage.removeItem("usuario"),this.router.navigate(["/login"])},e=>{console.error("Error al cerrar sesi\xf3n:",e)}))}agregarHorario(e){if(!e)return void console.error("El valor del d\xeda es nulo o indefinido.");const a=this.hora_apertura[e],d=this.hora_cierre[e];this.obtenerIdUsuario().subscribe(({idUsuario:t,idEmpresa:l})=>{if(null!==t&&null!==l){this.id_user=t,this.id_empresa=l;const u={dia:e,hora_apertura:a,hora_cierre:d,id_user:this.id_user,id_empresa:this.id_empresa},g=this.horariosSeleccionados.findIndex(_=>_.dia===e);-1!==g&&this.horariosSeleccionados.splice(g,1),this.horariosService.subirHorario(u,this.id_empresa,this.id_user).subscribe(_=>{console.log("Respuesta del servidor al subir horario:",_),this.horariosSeleccionados.push(u),this.diasSeleccionados.add(e),this.hora_apertura[e]="",this.hora_cierre[e]="",this.getHorarios()},_=>{console.error("Error al subir el horario:",_),console.log("Respuesta completa del servidor:",_)})}else console.error("No se pudo obtener el id de la empresa o el id del usuario.")})}getHorarios(){if("administrador"===this.rol||"encargado"===this.rol){const e=this.authService.getUserEmail();null!==e?this.usuariosService.getIdEmpresaPorEmail(e).subscribe(a=>{if(200===a.code&&a.data&&a.data.id_empresa){this.id_empresa=a.data.id_empresa;const d=this.id_empresa;isNaN(d)?console.error("ID de empresa no es un n\xfamero v\xe1lido:",d):this.horariosService.obtenerHorasByEmpresa(d).subscribe(t=>{200===t.code&&Array.isArray(t.data)?(this.horariosSeleccionados=this.horariosSeleccionados.map(l=>{const{dia:u}=l,m=t.data.findIndex(N=>N.dia===u);return-1!==m?{dia:u,hora_apertura:t.data[m].hora_apertura,hora_cierre:t.data[m].hora_cierre,id_user:t.data[m].id_user,id_empresa:t.data[m].id_empresa}:{dia:u,hora_apertura:"cerrado",hora_cierre:"cerrado",id_user:this.id_user,id_empresa:this.id_empresa}}),this.horariosSeleccionados=this.horariosSeleccionados.sort((l,u)=>this.diasSemana.indexOf(l.dia)-this.diasSemana.indexOf(u.dia)),console.log("Horarios obtenidos:",this.horariosSeleccionados)):console.error("La respuesta del servicio de horarios no es v\xe1lida:",t)},t=>{console.error("Error al obtener los horarios:",t)})}else console.error("No se pudo obtener el id_empresa del usuario:",a)},a=>{console.error("Error al obtener el id_empresa del usuario:",a)}):console.error("El email del usuario es nulo.")}else console.error("No tiene permiso para acceder a esta opci\xf3n.")}initHorariosPredeterminados(){this.horariosSeleccionados=this.diasSemana.map(e=>({dia:e,hora_apertura:"00:00",hora_cierre:"00:00",id_user:null!==this.id_user?this.id_user:0,id_empresa:null!==this.id_empresa?this.id_empresa:0})),this.cerradoMostrado={}}toggleDarkMode(){this.isDarkMode=!this.isDarkMode,this.themeService.setDarkTheme(this.isDarkMode)}cerrarSesion(){this.authService.logout().subscribe()}}return(i=n).\u0275fac=function(e){return new(e||i)(o.Y36(h.qu),o.Y36(f.F0),o.Y36(P.p),o.Y36(H.e),o.Y36(S.f),o.Y36(C.J),o.Y36(Z.h))},i.\u0275cmp=o.Xpm({type:i,selectors:[["app-horarios"]],decls:2,vars:2,consts:[[3,"class",4,"ngIf"],[4,"ngIf"],["slot","start"],["defaultHref","/home",2,"--color","#ff830f"],["color","primary"],["slot","end"],[3,"click"],[2,"color","#ff830f","font-size","24px",3,"name"],["name","log-out-outline","size","large",1,"color-salir"],[3,"formGroup"],["type","hidden","formControlName","id_empresa",3,"value"],["type","hidden","formControlName","id_user",3,"value"],[1,"encabezado",2,"font-weight","bold","text-align","center","color","#ff830f"],["size","4",2,"color","#ff830f"],["size","auto"],[4,"ngFor","ngForOf"],["size","8",2,"color","#ff830f"],["size","4",2,"font-weight","bold"],["size","4"],["type","time",3,"ngModel","ngModelChange"],[3,"disabled","click"],["name","add-outline"],["size","8"]],template:function(e,a){1&e&&o.YNc(0,O,11,3,"ion-header",0)(1,J,21,9,"ion-content",1),2&e&&(o.Q6J("ngIf","administrador"===a.rol||"encargado"===a.rol),o.xp6(),o.Q6J("ngIf","administrador"===a.rol||"encargado"===a.rol))},dependencies:[p.sg,p.O5,h._Y,h.Fj,h.JJ,h.JL,h.On,c.YG,c.Sm,c.wI,c.W2,c.jY,c.Gu,c.gu,c.pK,c.Nd,c.wd,c.sr,c.j9,c.oU,h.sg,h.u],styles:["ion-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%}ion-title[_ngcontent-%COMP%]{text-align:center}div.ion-padding[_ngcontent-%COMP%]{width:100%;max-width:600px}label[_ngcontent-%COMP%]{display:block;margin-top:10px}input[_ngcontent-%COMP%]{margin-bottom:10px}button[_ngcontent-%COMP%]{margin-top:20px}.tabla-horarios[_ngcontent-%COMP%]{border-collapse:collapse;width:100%;margin-bottom:20px!important}.tabla-horarios[_ngcontent-%COMP%]   .encabezado[_ngcontent-%COMP%]{background-color:#f2f2f2}.tabla-horarios[_ngcontent-%COMP%]   .fila[_ngcontent-%COMP%]{background-color:#fff}.tabla-horarios[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{border:1px solid #dddddd;padding:8px}.tabla-horarios[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]:first-child   ion-col[_ngcontent-%COMP%]{font-weight:700}.boton-agregar[_ngcontent-%COMP%], .tabla-horarios[_ngcontent-%COMP%]:last-child{display:flex;justify-content:center;margin-top:16px!important}ion-input[_ngcontent-%COMP%]{width:90px}.color-salir[_ngcontent-%COMP%]{color:#ff830f}.dark-text[_ngcontent-%COMP%]{color:#fff}"]}),n})()}];let y=(()=>{var i;class n{}return(i=n).\u0275fac=function(e){return new(e||i)},i.\u0275mod=o.oAB({type:i}),i.\u0275inj=o.cJS({imports:[f.Bz.forChild(w),f.Bz]}),n})(),k=(()=>{var i;class n{}return(i=n).\u0275fac=function(e){return new(e||i)},i.\u0275mod=o.oAB({type:i}),i.\u0275inj=o.cJS({imports:[p.ez,h.u5,c.Pc,h.UX,y]}),n})()}}]);